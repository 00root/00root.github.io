
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>Hexo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="John Doe">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@stanosaka">

    
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/toad.ico">
    
    
    <link rel="apple-touch-icon" href="/img/toadman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/toadman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/%02.css">
<link rel="stylesheet" href="/.css">

<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/toadman.png" alt="Hexo" title="Hexo"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Hexo">Hexo</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:example.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/05/05/docker/" title="docker" itemprop="url">docker</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2019-05-05T06:47:47.000Z" itemprop="datePublished"> Published 2019-05-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><strong>what is docker</strong></p>
<ul>
<li>Open platform</li>
<li>Build, ship, and run applications</li>
<li>Popular because:<ul>
<li>Flexible</li>
<li>Lightweight</li>
<li>Interchangeable</li>
<li>Portable</li>
<li>Scalable<h2 id="List-Docker-CLI-commands"><a href="#List-Docker-CLI-commands" class="headerlink" title="List Docker CLI commands"></a>List Docker CLI commands</h2></li>
</ul>
</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">docker</span><br><span class="line">docker container --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Display Docker version and info</span></span><br><span class="line">docker --version</span><br><span class="line">docker version</span><br><span class="line">docker info</span><br><span class="line"></span><br><span class="line"><span class="comment">## Execute Docker image</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker images</span></span><br><span class="line">docker image ls</span><br><span class="line"></span><br><span class="line"><span class="comment">## List Docker containers (running, all, all in quiet mode)</span></span><br><span class="line">docker container ls</span><br><span class="line">docker container ls --all</span><br><span class="line">docker container ls -aq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker build -t friendlyhello .  <span class="comment"># Create image using this directory&#x27;s Dockerfile</span></span><br><span class="line">docker run -p 4000:80 friendlyhello  <span class="comment"># Run &quot;friendlyhello&quot; mapping port 4000 to 80</span></span><br><span class="line">docker run -d -p 4000:80 friendlyhello         <span class="comment"># Same thing, but in detached mode</span></span><br><span class="line">docker container ls                                <span class="comment"># List all running containers</span></span><br><span class="line">docker container ls -a             <span class="comment"># List all containers, even those not running</span></span><br><span class="line">docker container stop &lt;<span class="built_in">hash</span>&gt;           <span class="comment"># Gracefully stop the specified container</span></span><br><span class="line">docker container <span class="built_in">kill</span> &lt;<span class="built_in">hash</span>&gt;         <span class="comment"># Force shutdown of the specified container</span></span><br><span class="line">docker container rm &lt;<span class="built_in">hash</span>&gt;        <span class="comment"># Remove specified container from this machine</span></span><br><span class="line">docker container rm $(docker container ls -a -q)         <span class="comment"># Remove all containers</span></span><br><span class="line">docker image ls -a                             <span class="comment"># List all images on this machine</span></span><br><span class="line">docker image rm &lt;image id&gt;            <span class="comment"># Remove specified image from this machine</span></span><br><span class="line">docker image rm $(docker image ls -a -q)   <span class="comment"># Remove all images from this machine</span></span><br><span class="line">docker rm   <span class="comment"># deletes a stopped container</span></span><br><span class="line">docker rmi  <span class="comment"># deletes a container image</span></span><br><span class="line">docker login             <span class="comment"># Log in this CLI session using your Docker credentials</span></span><br><span class="line">docker tag &lt;image&gt; username/repository:tag  <span class="comment"># Tag &lt;image&gt; for upload to registry</span></span><br><span class="line">docker push username/repository:tag            <span class="comment"># Upload tagged image to registry</span></span><br><span class="line">docker run username/repository:tag                   <span class="comment"># Run image from a registry</span></span><br><span class="line">docker system prune -fa <span class="comment">#will remove any container images that are not tied to an existing runningcontainer, along with any other resources in your Docker environment</span></span><br></pre></td></tr></table></figure>

<h1 id="Beginning-Devops-with-Docker"><a href="#Beginning-Devops-with-Docker" class="headerlink" title="Beginning Devops with Docker"></a>Beginning Devops with Docker</h1><h2 id="Chapter-1-Images-and-Containers"><a href="#Chapter-1-Images-and-Containers" class="headerlink" title="Chapter 1. Images and Containers"></a>Chapter 1. Images and Containers</h2><p><strong>Virtualization versus Containerization</strong><br><img src="https://i.imgur.com/KKfsLxn.png" alt="virtual machine block diagram"><br>In virtual machines, the physical hardware is abstracted, therefore we have may server running on one server. Virtual machines do sometimes take time to start up and are expensive in capacity (they can be GBs in size), although the greatest advantage they have over containers is the ability to run different Linux distributions such as CentOS instead of just Ubuntu.</p>
<p><img src="https://i.imgur.com/rWfUi8x.png" alt="containerization"><br>In containerization, it is only the app layer (where code and dependencies are packaged) that is abstracted, making it possible for many containers to run on the same OS kernel but on separate user space.</p>
<p>Containers use less space and boot fast.</p>
<ul>
<li>Describe how Docker improves a DevOps workflow<br>Normally, we have two pieces to a working application: the project code base and the provisioning script. The code base is the application code. It is managed by version control and hosted in GitHub, among other platforms.<br><img src="https://i.imgur.com/7bpoPrj.png" alt="Docker implements"><br>The <strong>Dockerfile</strong> takes the place of the provisioning script. The two combined (project code and Dockerfile) make a <strong>Docker image</strong>. A Docker image can be run as an application. This running application sourced from a Docker image is called a <strong>Docker container</strong>.</li>
</ul>
<p><strong>Basic Docker Terminal Commands</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker info ## displays system-wide information</span><br><span class="line">docker search &lt;term&gt; (foir example. docker search ubuntu) ##searches Docker Hub for Images</span><br><span class="line">docker pull ## pulls an image from the registry to your local machine eg docker pull ubuntu</span><br><span class="line">docker images ## lists the Docker images we have locally</span><br><span class="line">docker run &lt;image&gt; #will check whether the image by the name hello-world exists locally,if the image is</span><br><span class="line">not local, it will be pulled form the default registry, Docker Hub, and run as a container, by default</span><br><span class="line"></span><br><span class="line">docker ps ## lists the running containers</span><br><span class="line">docker stop &lt;container ID&gt;  ## stop the container </span><br><span class="line">docker rm &lt;container ID&gt; ## Delete the container and the image</span><br></pre></td></tr></table></figure>

<ul>
<li>Interpret Dockerfile syntax</li>
<li>Build images</li>
<li>Set up containers and images</li>
<li>Set up a local dynamic environment</li>
<li>Run applications in Docker containers</li>
<li>Obtain a basic overview of how Docker manages images via Docker Hub</li>
<li>Deploy a Docker image to Docker Hub</li>
</ul>
<p><strong>The Dockerfile</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM openjdk:8-jre-alpine</span><br><span class="line"></span><br><span class="line">ENV SPRING_OUTPUT_ANSI_ENABLED&#x3D;ALWAYS \</span><br><span class="line">    JHIPSTER_SLEEP&#x3D;0 \</span><br><span class="line">    JAVA_OPTS&#x3D;&quot;&quot;</span><br><span class="line"></span><br><span class="line">CMD echo &quot;The application will start in $&#123;JHIPSTER_SLEEP&#125;s...&quot; &amp;&amp; \</span><br><span class="line">    sleep $&#123;JHIPSTER_SLEEP&#125; &amp;&amp; \</span><br><span class="line">    java $&#123;JAVA_OPTS&#125; -Djava.security.egd&#x3D;file:&#x2F;dev&#x2F;.&#x2F;urandom -jar &#x2F;app.war</span><br><span class="line"></span><br><span class="line">EXPOSE 8080 5701&#x2F;udp</span><br><span class="line"></span><br><span class="line">ADD *.war &#x2F;app.war</span><br></pre></td></tr></table></figure>
<p>The <strong>FROM</strong> instruction specifies the base image to use while initializing the build. Here, we specify open JDK 8 as our Java runtime.</p>
<p>The <strong>ENV</strong> instruction is used to set environment variables, and the <strong>CMD</strong> instruction is used to specify commands to be executed.</p>
<p>The <strong>EXPOSE</strong> instruction is used to specify the port that the container listens to during runtime.</p>
<p><strong>useful commands for Docker and Docker compose</strong><br><img src="https://i.imgur.com/FAExCVU.png" alt="commands1"><br><img src="https://i.imgur.com/LtTRrfD.png" alt="commands2"></p>
<h2 id="Docker-compose"><a href="#Docker-compose" class="headerlink" title="Docker-compose"></a>Docker-compose</h2><p><strong>Sample docker-compose file that will start a Rdis database on port 5000</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3&#39;</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">     - &quot;5000:5000&quot;</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br></pre></td></tr></table></figure>
<p>The first line of the <em>docker-compose</em> file should be the version of the <em>docker-compose</em> tool. </p>
<p>Then we need to specify all the necessary services that we need for our application to run. They should be defined in the <em>services:</em> section.</p>
<p>We can also define multiple services inside here, giving a name to each (<em>web</em> and <em>redis</em>).</p>
<p>This is followed by how to build the <em>service</em> (either via a command to build or referring a Dockerfile). </p>
<p>If the application needs any port access, we can configure it using <em>5000:5000</em> (that is internal port: external port). </p>
<p>Then, we have to specify the volume information. This basically tells <em>docker-compose</em> to serve the files from the location specified.   </p>
<p>Once we have specified the services required for our application, then we can start the application via <em>docker-compose</em>. This will start your entire application along with the services, and expose the <em>services</em> on the port specified. </p>
<p>With <em>docker-compose</em>, we can perform the following operations:</p>
<ul>
<li><p><strong>Start</strong>: docker-compose -f <docker_file> up</p>
</li>
<li><p><strong>Stop</strong>: docker-compose -f <docker_file> down<br>We can also perform the following operations:</p>
</li>
<li><p><strong>List the running services and their status</strong>: <em>docker ps</em></p>
</li>
<li><p><strong>Logs</strong>: <em>docker log <container_id></em></p>
</li>
</ul>
<h2 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h2><p>A single deployable component is called a <strong>pod</strong> in Kubernetes. This can be as simple as a running process in the container. A group of pods can be combined together to form a <strong>deployment</strong>. </p>
<p>The following code is a sample Kubernetes file that will start a Nginx server:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginxsvc</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: http</span><br><span class="line">  - port: 443</span><br><span class="line">    protocol: TCP</span><br><span class="line">    name: https</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></table></figure>
<ol>
<li><p>Start with an <em>apiVersion</em> in a Kubernetes deployment file.</p>
</li>
<li><p>Followed by the type, which takes either a pod, deployment, namespace, ingress (load balancing the pods), role, and many more.</p>
</li>
</ol>
<p>Ingress forms a layer between the services and the internet so that all the inbound connections are controlled or configured with the ingress controller before sending them to Kubernetes services on the cluster. On the other hand, the egress controller controls or configures services going out of the Kubernetes cluster.</p>
<ol start="3">
<li><p>This is followed by the metadata information, such as the type of environments, the application name (nginxsvc), and labels (Kubernetes uses this information to identify and segregate the pods). Kubernetes uses this metadata information to identify the particular pods or a group of pods, and we can manage the instances with this metadata. This is one of the key differences with docker-compose, where docker-compose doesn’t have the flexibility of defining the metadata about the containers.</p>
</li>
<li><p>This is followed by the spec, where we define the specification of the images or our application. We can also define the pull strategy for our images as well as define the environment variables along with the exposed ports. We can define the resource limitations on the machine (or VM) for a particular service. They provide health checks, that is, each service is monitored for the health and when some services fail, they are immediately replaced by newer ones. They also provide service discovery out of the box, by assigning each pod an IP, which makes it easier for the services to identify and interact with them. They also provide a better dashboard, to visualize your architecture and the status of the application. You can do most of the management via this dashboard, such as checking the status, logs, scale up, or down the services, and so on.</p>
</li>
</ol>
<h2 id="Docker-ps-command"><a href="#Docker-ps-command" class="headerlink" title="Docker ps command"></a>Docker ps command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Image&#125;&#125; \t &#123;&#123;.Ports&#125;&#125; \t &#123;&#123;.Names&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID         IMAGE                   PORTS                                                NAMES</span><br><span class="line">7d3a6d518e8e         jenkinsci/blueocean     0.0.0.0:8080-&gt;8080/tcp, 0.0.0.0:50000-&gt;50000/tcp     jenkins</span><br><span class="line">9655eb0e836e         alpine                                                                       quotes</span><br><span class="line">root@stan-OptiPlex-380:~|⇒  docker ps --format <span class="string">&quot;table &#123;&#123;.ID&#125;&#125; \t &#123;&#123;.Names &#125;&#125; \t &#123;&#123;.Status&#125;&#125;&quot;</span></span><br><span class="line">CONTAINER ID         NAMES               STATUS</span><br><span class="line">7d3a6d518e8e         jenkins             Up 2 minutes</span><br><span class="line">9655eb0e836e         quotes              Up 4 hours</span><br></pre></td></tr></table></figure>

<h2 id="Docker-networking"><a href="#Docker-networking" class="headerlink" title="Docker networking"></a>Docker networking</h2><p>-Mostly used types</p>
<ul>
<li>Bridge networks<ul>
<li>The default network driver</li>
<li>Applications run in standalone containers that need to communicate</li>
</ul>
</li>
<li>Overlay networks:<ul>
<li>Connect multiple Docker daemons together</li>
<li>Enable swarm services to communicate with each other</li>
</ul>
</li>
</ul>
<p><strong>Docker basic networking</strong></p>
<ul>
<li>Step 1: create a network and volume</li>
</ul>
<p>Listing and creating a network:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br><span class="line">docker network create net1</span><br></pre></td></tr></table></figure>
<p>Listing and creating a volume:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker volume ls</span><br><span class="line">docker volume create --driver&#x3D;local --name&#x3D;volume1</span><br></pre></td></tr></table></figure>
<ul>
<li>Step 2: start docker containers<ul>
<li>Starting docker containers:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name&#x3D;container1 -v volume1:&#x2F;opt --network&#x3D;net1 busybox sh</span><br><span class="line">docker run -it --name&#x3D;container2 -v volume1:&#x2F;opt --network&#x3D;net1 busybox sh</span><br><span class="line">#-t is used for interactive session and t will give you the terminal</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>Step 3: test connectivity between these containers<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># ping container2</span><br><span class="line">PING container2 (172.19.0.3): 56 data bytes</span><br><span class="line">64 bytes from 172.19.0.3: seq&#x3D;0 ttl&#x3D;64 time&#x3D;0.170 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq&#x3D;1 ttl&#x3D;64 time&#x3D;0.134 ms</span><br><span class="line">64 bytes from 172.19.0.3: seq&#x3D;2 ttl&#x3D;64 time&#x3D;0.133 ms</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>Overlay networking</strong></p>
<p><strong>What does an overlay network do?</strong></p>
<ul>
<li><p>Containers only connect to other containers on the same network </p>
</li>
<li><p>Connecting to containers on other hosts requires that the container publish the needed port </p>
</li>
<li><p>Overlay network allows containers running on different hosts to connect on a private network<br><img src="https://i.imgur.com/KjgJtA0.png" alt="overlay networking"></p>
</li>
<li><p>Step 1: Initiate docker swarm</p>
<blockquote>
<p>Host1: Check networks and initiate docker swarm:<br> docker network ls<br> docker swarm init<br>Host2: Initiate swarm worker and check its networks:<br> docker swarm join –toaken foobar 192.168.10.91:2377<br> docker network ls</p>
</blockquote>
</li>
<li><p>Step 2: Create overlay network and spin a docker container on host1</p>
<blockquote>
<p>Create an overlay network:<br> docker network create -d overlay –atachable=true swarmnet</p>
</blockquote>
<ul>
<li>List networks:<br>docker network ls</li>
<li>Spin a Docker container:<br>docker run -itd –name container1 –network swarmnet busybox</li>
</ul>
</li>
<li><p>Step 3: Spin a container on host2 and check its networks</p>
<blockquote>
<p>List networks:<br> docker network ls</p>
</blockquote>
<ul>
<li>Spin a Docker container:<br>docker run -itd –name container2 –network swarmnet busybox</li>
<li>List networks and see new network:<br>docker network ls</li>
</ul>
</li>
<li><p>Step 4: Login to the containers check its networks and sing each other</p>
<blockquote>
<p>Host1: Log in to the container, check IPs, and ping container on Host2:<br>   docker exec -it container1 sh<br>   ifconfig<br>   ping container2<br>Host2:  Log in to the container, check IPs, and ping container on Host1:<br>   docker exec -it container2 sh<br>   ifconfig<br>   ping container1</p>
</blockquote>
</li>
</ul>
<h1 id="upload-that-new-image-to-dockerhub"><a href="#upload-that-new-image-to-dockerhub" class="headerlink" title="upload that new image to dockerhub"></a>upload that new image to dockerhub</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag helloworld stanosaka&#x2F;helloworld</span><br><span class="line">docker push stanosaka&#x2F;helloworld</span><br></pre></td></tr></table></figure>

<p>Cleaning up containers:We can clean up everything by stopping and removing all containers with these two handy one-line commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop $(docker ps -a -q)</span><br><span class="line">$ docker system prune</span><br></pre></td></tr></table></figure>
<h1 id="Amazon-web-services-and-docker-development"><a href="#Amazon-web-services-and-docker-development" class="headerlink" title="Amazon web services and docker development"></a>Amazon web services and docker development</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install     apt-transport-https     ca-certificates     curl</span><br><span class="line">curl -fsSL https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu&#x2F;gpg | sudo apt-key</span><br><span class="line">add-apt-repository    &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br><span class="line">apt update</span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl status docker</span><br><span class="line"></span><br><span class="line">root@ip-172-31-6-219:~# cat dockerfile</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt install -y apache2</span><br><span class="line">RUN echo &quot;Welcome to my web site&quot; &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html</span><br><span class="line">CMD &#x2F;usr&#x2F;sbin&#x2F;apache2ctl -D FOREGROUND</span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker info</span><br><span class="line">docker run -it --detach&#x3D;true ubuntu bash</span><br><span class="line">docker ps</span><br><span class="line">docker renmae nervous_visvesvaraya newname</span><br><span class="line">docker network inspect newnet|less</span><br><span class="line">docker network connect newnet newname</span><br><span class="line">docker inspect newname|less</span><br><span class="line">ping 172.18.0.2</span><br><span class="line">ping 172.17.0.2</span><br><span class="line">docker build -t &quot;webserver&quot; .</span><br><span class="line">docker images</span><br><span class="line">docker run -d -p 80:80 webserver &#x2F;usr&#x2F;sbin&#x2F;apache2ctl -D FOREGROUND</span><br><span class="line">docker ps</span><br><span class="line">curl localhost</span><br><span class="line"> aws iam create-service-linked-role --aws-service-name ecs.amazonaws.com</span><br><span class="line">&#123;</span><br><span class="line">    &quot;Role&quot;: &#123;</span><br><span class="line">        &quot;AssumeRolePolicyDocument&quot;: &#123;</span><br><span class="line">            &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">            &quot;Statement&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Action&quot;: [</span><br><span class="line">                        &quot;sts:AssumeRole&quot;</span><br><span class="line">                    ],</span><br><span class="line">                    &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">                    &quot;Principal&quot;: &#123;</span><br><span class="line">                        &quot;Service&quot;: [</span><br><span class="line">                            &quot;ecs.amazonaws.com&quot;</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RoleId&quot;: &quot;AROAYYRUPCKTK7Z2M2PLO&quot;,</span><br><span class="line">        &quot;CreateDate&quot;: &quot;2019-09-02T02:28:51Z&quot;,</span><br><span class="line">        &quot;RoleName&quot;: &quot;AWSServiceRoleForECS&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;&#x2F;aws-service-role&#x2F;ecs.amazonaws.com&#x2F;&quot;,</span><br><span class="line">        &quot;Arn&quot;: &quot;arn:aws:iam::602479202982:role&#x2F;aws-service-role&#x2F;ecs.amazonaws.com&#x2F;AWSServiceRoleForECS&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Working-with-ecs-throught-the-aws-cli"><a href="#Working-with-ecs-throught-the-aws-cli" class="headerlink" title="Working with ecs throught the aws cli"></a>Working with ecs throught the aws cli</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws ecs list-clusters</span><br><span class="line">aws ecs describe-clusters</span><br><span class="line">aws ecs create-cluster --cluster-name newcluster</span><br></pre></td></tr></table></figure>
<p><strong>Configure ECS to authenticate with Docker Hub</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#1.ssh to ecs server</span><br><span class="line">cd &#x2F;etc&#x2F;ecs</span><br><span class="line">[root@ip-172-31-13-18 ecs]# vim ecs.config</span><br><span class="line">ECS_ENGINE_AUTH_TYPE&#x3D;docker</span><br><span class="line">ECS_ENGINE_AUTH_DATA&#x3D;&#123;&quot;https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;&quot;:&#123;&quot;username&quot;:&quot;foobar&quot;,&quot;password&quot;:&quot;badpassword&quot;,&quot;email&quot;:&quot;foo.bar@gmail.com&quot;&#125;&#125;</span><br><span class="line">[root@ip-172-31-13-18 ecs]# stop ecs</span><br><span class="line">ecs stop&#x2F;waiting</span><br><span class="line">[root@ip-172-31-13-18 ecs]# start ecs</span><br><span class="line">ecs start&#x2F;running, process 4996</span><br><span class="line">[root@ip-172-31-13-18 ecs]# docker inspect ecs-agent|grep ECS_DATADIR</span><br><span class="line">                &quot;ECS_DATADIR&#x3D;&#x2F;data&quot;,</span><br><span class="line">#2. make repo private in docker hub</span><br><span class="line">#3. configure in aws console about ecs</span><br></pre></td></tr></table></figure>

<p><strong>working with ec2 container registry (ECR)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws ecr get-login help</span><br><span class="line">docker login -u AWS -p badpassword https:&#x2F;&#x2F;602479202982.dkr.ecr.ap-southeast-2.amazonaws.com</span><br><span class="line">docker images</span><br><span class="line">docker tag c0a44e0f3831 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com&#x2F;myrepo</span><br><span class="line">docker push 602479202982.dkr.ecr.ap-southeast-2.amazonaws.com&#x2F;myrepo</span><br></pre></td></tr></table></figure>

<h2 id="Docker-registry"><a href="#Docker-registry" class="headerlink" title="Docker registry"></a>Docker registry</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 5000:5000 --restart always --name registry registry:2</span><br><span class="line">docker pull hello-world</span><br><span class="line">docker tag hello-world localhost:5000&#x2F;hello-world</span><br><span class="line">docker push localhost:5000&#x2F;hello-world</span><br><span class="line">docker exec -it registry &#x2F;bin&#x2F;sh</span><br><span class="line">docker images</span><br><span class="line">docker rmi hello-world</span><br><span class="line">docker rmi localhost:5000&#x2F;hello-world</span><br><span class="line">docker images</span><br><span class="line">docker pull localhost:5000&#x2F;hello-world</span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_HOST&#x3D;registry \</span><br><span class="line">  -e ENV_DOCKER_REGISTRY_PORT&#x3D;5000 \</span><br><span class="line">  -p 8080:80 \</span><br><span class="line">  --link registry:registry \</span><br><span class="line">  konradkleine&#x2F;docker-registry-frontend:v2</span><br></pre></td></tr></table></figure>


<h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><ol>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> docker login 127.0.0.1:5000</span><br><span class="line">Username: myuser</span><br><span class="line">Password:</span><br><span class="line">** Message: 17:25:24.126: Remote error from secret service: org.freedesktop.Secret.Error.IsLocked: Cannot create an item in a locked collection</span><br><span class="line">Error saving credentials: error storing credentials - err: exit status 1, out: &#96;Cannot create an item in a locked collection&#96;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>Fix by:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker logout</span><br><span class="line">Removing login credentials for https:&#x2F;&#x2F;index.docker.io&#x2F;v1&#x2F;</span><br><span class="line">➜  outyet git:(master) mv ~&#x2F;.docker&#x2F;config.json ~&#x2F;.docker&#x2F;config_old.json</span><br><span class="line">➜  outyet git:(master) docke login</span><br><span class="line">zsh: command not found: docke</span><br><span class="line">➜  outyet git:(master) docker login 127.0.0.1:5000</span><br><span class="line">Username: myuser</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in &#x2F;home&#x2F;stan&#x2F;.docker&#x2F;config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;login&#x2F;#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/docker/">docker</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/24/pipeline/" title="pipeline" itemprop="url">pipeline</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2019-02-24T09:39:06.000Z" itemprop="datePublished"> Published 2019-02-24</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Pipeline</p>
<p>Represents a part of:</p>
<ul>
<li>Software delivery</li>
<li>Quality assurance process</li>
</ul>
<p>Benefits:</p>
<ul>
<li>Operation grouping</li>
<li>Visibility</li>
<li>Feedback</li>
</ul>
<p><strong>Automated deployment pipeline</strong><br>3 stages:<br>code change-&gt; Continuous Integration-&gt; Automated acceptance testing-&gt; Configuration management</p>
<ol>
<li>Continuous Integration<br>The continuous integration phase provides the first feedback to the developers. It checks out the code from the repository, compiles it, runs unit tests and verifies the code quality. If any step fails the pipeline execution is stopped and the first thing the developer should do is fix the continuous integration build. The continuous integration pipeline is usually the starting point.</li>
</ol>
<ul>
<li>first feedback</li>
<li>checks code</li>
<li>starting point</li>
<li>simple to setup</li>
</ul>
<ol start="2">
<li>Automated acceptance testing</li>
</ol>
<ul>
<li>Suites of tests</li>
<li>A quality gate</li>
<li>Pipeline execution is stopped if test fails</li>
<li>Prevents movement</li>
<li>Lot of confusion</li>
</ul>
<p><img src="https://i.imgur.com/KGWFQPx.png" alt="Agile testing matrix"></p>
<ol>
<li>Acceptance testing</li>
</ol>
<ul>
<li>Represent functional requirements</li>
<li>Wrtten in the form of stories or examples</li>
</ul>
<ol start="2">
<li>Unit Testing</li>
</ol>
<ul>
<li>Provide the high-quality software</li>
<li>Minimize the number of bugs</li>
</ul>
<ol start="3">
<li>Exploratory Testing</li>
</ol>
<ul>
<li>Manual black-box testing</li>
<li>Breaks or improves the system</li>
</ul>
<ol start="4">
<li>Non-functional testing</li>
</ol>
<ul>
<li>Represent properties:<ul>
<li>Performance</li>
<li>Scalability</li>
<li>Security</li>
</ul>
</li>
</ul>
<ol start="3">
<li>Configuration management</li>
</ol>
<ul>
<li>Replaces the manual operations</li>
<li>Responsible for tracking and controlling changes</li>
<li>Solution to the problems</li>
<li>Enable storing configuration files<br>Configuration management is a solution to the problems posed by manually deploying and configuring applications on the production. Configuration management tools enables storing configuration files in the version control system and tracking every change that was made on the production servers.</li>
</ul>
<p><strong>Technical and development prerequisites</strong></p>
<ul>
<li>Automated build, test, package, and deploy operations</li>
<li>Quick pipeline execution</li>
<li>Quick failure recovery</li>
<li>Zero-downtime deployment</li>
<li>Trunk-based deployment</li>
</ul>
<p><strong>Building the continuous delivery process</strong><br>Jenkins</p>
<ul>
<li>Popular automation server</li>
<li>Helps create automated sequence of scripts</li>
<li>Plugin-oriented</li>
</ul>
<p>Ansible<br>Helps with:</p>
<ul>
<li>Software provisioning</li>
<li>Configuration management</li>
<li>Application deployment</li>
</ul>
<p>Java</p>
<ul>
<li>Most popular programming language</li>
<li>Develop with the Spring framework</li>
<li>Gradle-build tool<br>Jenkins is by far the most popular automation server on the market. It helps to create continuous integration and continuous delivery pipelines and in general any other automated sequence of scripts. Highly plug-in oriented it has a greater community which constantly extends it with new features. Another one is Ansible. Ansible is an automation tool that helps with software provisioning configuration management and application deployment. Next comes Java. Java has been the most popular programming language for years, that is why it is being used for most code examples. Together with Java, most companies develop with the Spring framework so we used it to create a simple web service needed to explain some concepts. Gradle is used as a build tool. It is less popular than Maven however trending much faster.</li>
</ul>
<p><strong>Pipeline elements</strong></p>
<ul>
<li>Basic elements</li>
<li>Stage - Logical separation</li>
<li>Setp - Used to visualize process<br><img src="https://i.imgur.com/J7xJ8KG.png" alt="elements"></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">   &#x2F;&#x2F;agent any</span><br><span class="line">   agent &#123;</span><br><span class="line">      label &#39;linux&#39;</span><br><span class="line">   &#125;</span><br><span class="line">   stages &#123;</span><br><span class="line">      stage(&#39;First Stage&#39;) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo &#39;Step 1. Hello World&#39;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      stage(&#39;Second Stage&#39;) &#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">              echo &#39;Step 2. Second time Hello&#39;</span><br><span class="line">              echo &#39;Step 3. Third time Hello&#39;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   post &#123;</span><br><span class="line">     always &#123;</span><br><span class="line">        echo &quot;Pipeline executed!&quot;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Define pipeline structure<br>A declarative pipeline is always specified inside the pipeline block and contains sections, directives and steps. </li>
</ul>
<p>A declarative pipeline has a simplified and opinionated syntax on top of the pipeline sub-system.</p>
<p><strong>Sections</strong></p>
<ul>
<li>Keywords are:<ul>
<li>Agent-defines on which agent the pipeline or the stage will be executed</li>
<li>Stages-defines the stages of the pipeline</li>
<li>Step</li>
<li>Post-defines the post build steps</li>
</ul>
</li>
</ul>
<p>Sections define the pipeline structure and usually contain one or more directives or steps. They are defined with the key words, stages, step and post.</p>
<p>Stages defines a series of one or more stage directives.</p>
<p>Steps defines a series of one or more step instructions.</p>
<p>Steps are the most fundamental part of the pipeline they define the operations that are executed so they actually tell Jenkins what to do.</p>
<p>Defined using:</p>
<ul>
<li>sh: executes the shell command</li>
<li>custom</li>
<li>script</li>
</ul>
<p>Posts defines a series of one or more step instructions that are run at the end of the pipeline build.</p>
<p><strong>Directives</strong></p>
<ul>
<li>Expresses the configuration of a pipeline or its parts</li>
<li>Defined by:<ul>
<li>Agent: specifies where the execution takes place</li>
<li>Triggers: define automated ways to trigger the pipeline and can use cron to set the time based scheduling</li>
<li>Options: specified pipeline specific options</li>
<li>Environment: deinfes a set of key values used a s environment variables</li>
<li>Parameters: define a list of user input parameters</li>
<li>Tools: defines the tools configured on Jenkins</li>
<li>Stage: allows for logical grouping of steps; contains steps and agent </li>
<li>When: determines whether the stage should be executed depending on the given condition</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line">   tools &#123;</span><br><span class="line">      maven &#39;M3&#39;</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   parameters &#123;</span><br><span class="line">      string(name: &#39;VERSION&#39;,</span><br><span class="line">          defaultValue: &#39;1.0.0&#39;,</span><br><span class="line">          description: &#39;What is the version to build?&#39;)</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">   stages &#123;</span><br><span class="line">      stage(&#39;Build&#39;)&#123;</span><br><span class="line">          steps &#123;</span><br><span class="line">             sh &quot;.&#x2F;build.sh $&#123;params.VERSION&#125;&quot;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Commit-Pipeline"><a href="#Commit-Pipeline" class="headerlink" title="Commit Pipeline"></a>Commit Pipeline</h2><ul>
<li>Basic continuous integration process</li>
<li>Results in a report about the build</li>
<li>Runs after each change in the code</li>
<li>Consume a reasonable amount of resources</li>
<li>Starting point</li>
</ul>
<p>Since it runs after every change in the code, the build should take no more than five minutes and should consume a reasonable amount of resources. The commit phase is always the starting point of the continuous delivery process and it provides the most important feedback cycle in the development process.</p>
<p>In the commit phase a developer checks in the code to the repository.<br>The continuous integration server detects the change and the build starts.<br>The most fundamental commit pipeline contains three stages </p>
<ul>
<li>checkout</li>
<li>compile</li>
<li>unit test</li>
</ul>
<h2 id="Code-Quality-Stages"><a href="#Code-Quality-Stages" class="headerlink" title="Code Quality Stages"></a>Code Quality Stages</h2><p><strong>Extending continuous integration</strong></p>
<ul>
<li>The most widely used are: Code coverage and Static analysis</li>
</ul>
<p><strong>Code coverage</strong></p>
<ul>
<li>Scenario:<ul>
<li>Nobody writes unit tests</li>
<li>Passes all the builds</li>
</ul>
</li>
<li>Solution:<ul>
<li>Add coverage code tools</li>
</ul>
</li>
<li>Creates report</li>
<li>Make build fail</li>
</ul>
<p><strong>Available tools</strong></p>
<ul>
<li>JaCoCo</li>
<li>Clover</li>
<li>Cobertura</li>
</ul>
<p><strong>Static Code Analysis</strong></p>
<ul>
<li>Checks without execution</li>
<li>Checks number of rules</li>
<li>Rules apply to wide range of aspects</li>
<li>Popular tools are Checkstyle, FindBugs, and PMD</li>
</ul>
<p><strong>SonarQube</strong></p>
<ul>
<li>Quality management tool</li>
<li>An alternative</li>
<li>Aggregates different code analysis frameworks</li>
<li>Has own dashboards</li>
<li>User friendly web interface</li>
</ul>
<h2 id="Triggers-and-notifications"><a href="#Triggers-and-notifications" class="headerlink" title="Triggers and notifications"></a>Triggers and notifications</h2><p><strong>Triggers</strong></p>
<ul>
<li>Automatic action to start the build</li>
<li>Manay options to choose from</li>
<li>Three types:<ul>
<li>External</li>
<li>Polling SCM</li>
<li>Scheduled build</li>
</ul>
</li>
</ul>
<p><strong>External Trigger</strong></p>
<ul>
<li>Natural to understand</li>
<li>Starts the build after it’s called by the notifier</li>
</ul>
<p>GitHub -&gt; trigger-&gt; Jenkins</p>
<p><strong>Polling SCM</strong></p>
<ul>
<li>Periodically calls Github</li>
<li>Sound counter-intuitive<br>Polling SCM trigger is less intuitive.<br><img src="https://i.imgur.com/s6L2bbo.png" alt="Polling SCM figure"><br>Jenkins periodically calls GitHub and checks if there were any push to the repository. Then it starts the build.</li>
</ul>
<p><strong>Scheduled build</strong></p>
<ul>
<li>Jenkins runs the build periodically</li>
<li>No communication with any system</li>
<li>Implementation of scheduled build is same as polling SCM</li>
<li>Used for the commit pipeline</li>
</ul>
<p><strong>Notifications</strong></p>
<ul>
<li>Lot</li>
</ul>
<h2 id="Team-development-strategies"><a href="#Team-development-strategies" class="headerlink" title="Team development strategies"></a>Team development strategies</h2><p><strong>Development workflows</strong></p>
<ul>
<li>Put the code into the repostitory</li>
<li>Depends on many factors</li>
<li>Classify into three types:<ul>
<li><img src="https://i.imgur.com/WXIl9qU.png" alt="Trunk-based workflow"></li>
<li><img src="https://i.imgur.com/Oiury7J.png" alt="Branching workflow"></li>
<li><img src="https://i.imgur.com/5Uo3Ac9.png" alt="Forking workflow"></li>
</ul>
</li>
</ul>
<p><strong>Feature toggle</strong><br>Feature toggle is a technique that is an alternative to maintaining multiple source code branches such that the feature can be tested before it is completed and ready for use. It is used to disable the feature for users but enables it for developers while testing. Feature toggles are essentially variables used in conditional statements the simplest implementation of feature toggles are flags and the if statements.</p>
<p><strong>acceptance testing</strong><br>Acceptance testing is a test performed to determine if business requirements or contracts are met. </p>
<ul>
<li>Invovles black-box testing</li>
<li>Imply the acceptance of the software delivery</li>
<li>Also called UAT</li>
<li>Rely on manual steps</li>
<li>Reaonable to run them as programmed repeatable operations</li>
</ul>
<p><strong>Artifact repository</strong><br>While the source control management stores the source code the artifact repository is dedicated for storing software binary artifacts, for example, compiled libraries or components later used to build a complete application.</p>
<ul>
<li>Store binaries on a separate server due to:</li>
<li>File size</li>
<li>Versions</li>
<li>Revision mapping</li>
<li>Packages</li>
<li>Access Control</li>
<li>Clients</li>
<li>Use cases<br><img src="https://i.imgur.com/5gDLWLc.png" alt="working"></li>
</ul>
<p><strong>private docker registry</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p certs</span><br><span class="line"></span><br><span class="line">openssl req \\n  -newkey rsa:4096 -nodes -sha256 -keyout certs&#x2F;domain.key \\n  -x509 -days 365 -out certs&#x2F;domain.crt</span><br><span class="line"></span><br><span class="line">docker run -d -p 5000:5000 --restart&#x3D;always --name registry -v &#96;pwd&#96;&#x2F;auth:&#x2F;auth -e &quot;REGISTRY_AUTH&#x3D;htpasswd&quot; -e &quot;REGISTRY_AUTH_HTPASSWD_REALM&#x3D;Registry Realm&quot; -e REGISTRY_AUTH_HTPASSWD_PATH&#x3D;&#x2F;auth&#x2F;passwords -v &#96;pwd&#96;&#x2F;certs:&#x2F;certs -e REGISTRY_HTTP_TLS_CERTIFICATE&#x3D;&#x2F;certs&#x2F;domain.crt -e REGISTRY_HTTP_TLS_KEY&#x3D;&#x2F;certs&#x2F;domain.key registry:2</span><br><span class="line"></span><br><span class="line">docker tag ubuntu_with_python stanosaka&#x2F;ubuntu_with_python:1</span><br><span class="line">docker push stanosaka&#x2F;ubuntu_with_python:1</span><br></pre></td></tr></table></figure>

<p><strong>Acceptance test in pipeline</strong><br><img src="https://i.imgur.com/06nJoTO.png" alt="process"></p>
<ol>
<li>The developer pushes a code change to Github.</li>
<li>Jenkins detects the change, triggers the build and checks out the current code.</li>
<li>Jenkins executes the commit phase and builds the Docker image</li>
<li>Jenkins pushes the image to Docker Registry</li>
<li>Jenkins runs the Docker container in the staging environment</li>
</ol>
<p><strong>Configuration management</strong></p>
<ul>
<li>Process of controlling configuration changes</li>
<li>Used to refer to the software and the hardware</li>
</ul>
<p>Application Configuration| Infrastructre Configuration<br>Decides how the system works| Server infrastructure and environment configuration<br>Expressed in the form of flags| Takes care of the deployment process<br><img src="https://i.imgur.com/L4k4cb0.png" alt="working"><br><strong>Traits</strong></p>
<ul>
<li>Automation</li>
<li>Version Control</li>
<li>Incremental changes</li>
<li>Server provisioning</li>
<li>Security</li>
<li>Simplicity</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/devops/">devops</a><a href="/tags/pipeline/">pipeline</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2019/02/01/kubernetes-on-the-cloud/" title="kubernetes on the cloud" itemprop="url">kubernetes on the cloud</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2019-02-01T09:39:06.000Z" itemprop="datePublished"> Published 2019-02-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="Kubernetes-on-the-GKE"><a href="#Kubernetes-on-the-GKE" class="headerlink" title="Kubernetes on the GKE"></a>Kubernetes on the GKE</h1><p><strong>use cloud shell</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#setup zone</span><br><span class="line">gcloud config set compute&#x2F;zone australia-southeast1-a</span><br><span class="line">#setup region</span><br><span class="line">gcloud config set compute&#x2F;region australia-southeast1</span><br><span class="line"># create a single node cluster</span><br><span class="line">gcloud container clusters create my-first-cluster --num-nodes 1</span><br><span class="line"># see the list of clusters</span><br><span class="line">gcloud compute instances list</span><br><span class="line"># deploy a wordpress Docker container to our single node cluster</span><br><span class="line"># --image&#x3D;tutum&#x2F;wordpress: An out-fo-the-box image which includes everything you need</span><br><span class="line"># to run this site-including a MySQL database</span><br><span class="line">kubectl run wordpress --image&#x3D;tutum&#x2F;wordpress --port&#x3D;80</span><br><span class="line"># see the status of pods running</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ kubectl get pods</span><br><span class="line">NAME                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">wordpress-7fff795d48-kzbfr   1&#x2F;1     Running   0          5m36s</span><br></pre></td></tr></table></figure>
<p>By default a pod is accessible to only other internal machines in the cluster</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#kubectl expose pod: Exposed the pod a a service so it can be accessed externally</span><br><span class="line">#--type&#x3D;LoadBalancer: Creates an external IP that this pod can use to accept traffic</span><br><span class="line">kubectl expose pod wordpress-7fff795d48-kzbfr --name&#x3D;wordpress --type&#x3D;LoadBalancer</span><br><span class="line"># check </span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ kubectl describe svc wordpress</span><br><span class="line">Name:                     wordpress</span><br><span class="line">Namespace:                default</span><br><span class="line">Labels:                   pod-template-hash&#x3D;7fff795d48</span><br><span class="line">                          run&#x3D;wordpress</span><br><span class="line">Annotations:              &lt;none&gt;</span><br><span class="line">Selector:                 pod-template-hash&#x3D;7fff795d48,run&#x3D;wordpress</span><br><span class="line">Type:                     LoadBalancer</span><br><span class="line">IP:                       10.27.245.246</span><br><span class="line">LoadBalancer Ingress:     35.189.22.57</span><br><span class="line">Port:                     &lt;unset&gt;  80&#x2F;TCP</span><br><span class="line">TargetPort:               80&#x2F;TCP</span><br><span class="line">NodePort:                 &lt;unset&gt;  31344&#x2F;TCP</span><br><span class="line">Endpoints:                10.24.0.11:80</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason                Age    From                Message</span><br><span class="line">  ----    ------                ----   ----                -------</span><br><span class="line">  Normal  EnsuringLoadBalancer  2m17s  service-controller  Ensuring load balancer</span><br><span class="line">  Normal  EnsuredLoadBalancer   81s    service-controller  Ensured load balancer</span><br></pre></td></tr></table></figure>
<p><strong>How Kubernetes Works</strong><br>Kubernetes: Orchestration technology- convert isolated containers running on different hardware into a cluster</p>
<p>Pod: Atomic unit of deployment in Kubernetes.</p>
<ul>
<li>Consists of 1 or more tightly coupled containers.</li>
<li>Pod runs on node, which is controlled by master.</li>
<li>Kubernetes only knows about pods</li>
<li>Cannot start container without a pod</li>
<li>Pod =&gt; Sandbox for 1 or more cntainers</li>
</ul>
<p><img src="https://i.imgur.com/m8uoP3H.png" alt="pods"><br>Kubernetes::Hadoop</p>
<ul>
<li>Docker Container Engine -&gt; Java Runtime</li>
<li>Docker containers -&gt; Jars</li>
<li>Kubernetes -&gt; Hadoop</li>
</ul>
<p><strong>Kubernetes for Orchestration</strong></p>
<ul>
<li>Fault-tolerance: Pod/Nod failures</li>
<li>Auto-scaling: More clients? More demand</li>
<li>Rollback: Advanced deployment options</li>
<li>Auto-healing: Crashed containers restart</li>
<li>Load-balancing: Distribute client requests</li>
<li>Isolation: Sandboxes so that containers don’t interfere</li>
</ul>
<p><strong>kubectl</strong><br><img src="https://i.imgur.com/GryAqTK.png" alt="kubectl"><br>Telling k8s what the desire state is.</p>
<p><strong>What does the k8s master do?</strong><br>Kubernetes Master</p>
<ul>
<li>One or more nodes designated as master</li>
<li>Several k8s processes run on master</li>
<li>Multi-master for high-availability</li>
</ul>
<p><strong>kube-apiserver</strong></p>
<ul>
<li>Communicates with user</li>
<li>RESTful API end-points</li>
<li>Manifest yaml files are accepted by apiserver<br><img src="https://i.imgur.com/GA0zKFs.png" alt="apiserver"></li>
</ul>
<p><strong>etcd</strong><br>Cluster Store for Metadata</p>
<ul>
<li>Metadata about spec and status of cluster</li>
<li>etcd is consistent and highly available key-value store</li>
<li>source-of-truth for cluster state<br><img src="https://i.imgur.com/kQQe478.png" alt="etcd"></li>
</ul>
<p><strong>kube-scheduler</strong></p>
<ul>
<li>Handle pod creation and management</li>
<li>Kube-scheduler match/assign nodes to pods</li>
<li>Complex-affinities, taints, tolerations,…<br><img src="https://i.imgur.com/erz1Rpw.png" alt="scheduler"></li>
</ul>
<p><strong>controller-manager</strong></p>
<ul>
<li>Different master processes</li>
<li>Actual state &lt;-&gt; Desired State</li>
<li>cloud-controller-manager</li>
<li>kube-controller-manager</li>
<li>Node controller</li>
<li>Replication controller</li>
<li>Route controller</li>
<li>Volume controller<br><img src="https://i.imgur.com/iQpH2WD.png" alt="controller"></li>
</ul>
<p><strong>Control Plane</strong></p>
<ul>
<li>Apiserver</li>
<li>etc</li>
<li>scheduler</li>
<li>controller-manager<ul>
<li>cloud-controller-manager</li>
<li>kube-controller-manager<br><img src="https://i.imgur.com/ql9VYxt.png" alt="control plane"></li>
</ul>
</li>
</ul>
<p><strong>What runs on each node of a cluster?</strong><br>Kubernetes Node (Minion)</p>
<ul>
<li>Kubelet<ul>
<li>Agent running on this node</li>
<li>Listen to k8s master</li>
<li>Port 10255</li>
</ul>
</li>
<li>Kube-proxy<ul>
<li>Needed because pod IP addresses are ephemeral</li>
<li>Networking- will make sense when we discuss Service objects</li>
</ul>
</li>
<li>Container engine<ul>
<li>Works with kubelet</li>
<li>Pulling images</li>
<li>Start/stop</li>
<li>Could be Docker or rkt<br><img src="https://i.imgur.com/lXOojJr.png" alt="Minion"><br><img src="https://i.imgur.com/dft7Zwy.png" alt="Pod Creation Request"></li>
</ul>
</li>
</ul>
<p><strong>What are Pods?</strong><br><img src="https://i.imgur.com/5qt1aB6.png" alt="pod creation yaml"><br>Multi-Container Pods</p>
<ul>
<li>Share access to memory space</li>
<li>Connect to each other using localhost</li>
<li>Share access to the same volumes (storage abstraction)</li>
<li>Same parameters such as configMaps</li>
<li>Tight coupling is dangerous</li>
<li>Once crashes, all crash</li>
</ul>
<p><strong>Use cases for multi-container Pod</strong></p>
<ul>
<li>Main container, “sidecar” supporting containers<br><img src="https://i.imgur.com/ollFuAy.png" alt="main container"></li>
<li>Proxies, Bridges, Adapters<br><img src="https://i.imgur.com/kan5QHv.png" alt="Proxies"></li>
</ul>
<p><strong>Anti-Patterns for multi-container pods</strong></p>
<ul>
<li>Avoid packing three-tier web app into 1 pod</li>
<li>Do not pack multiple similar containers  in the same pod for scaling</li>
<li>Use Deployments or ReplicaSet instead</li>
<li>Micro0services: Simple, independent components</li>
</ul>
<p><strong>Pods limitations</strong></p>
<ul>
<li>No auto-healing or scaling</li>
<li>Pod crashes? Must be handled at higher level<ul>
<li>ReplicaSet,Deployment,Service</li>
</ul>
</li>
<li>Ephemeral: Ip address are ephemeral</li>
</ul>
<p><strong>Higer level k8s objects</strong></p>
<ul>
<li>ReplicaSet, ReplicationController: Scaling and healing</li>
<li>Deployment: Versioning and rollback</li>
<li>Service: Static (non-ephemeral) IP and networking</li>
<li>Volume: Non-ephemeral storage<h2 id="How-do-master-nodes-communicate"><a href="#How-do-master-nodes-communicate" class="headerlink" title="How do master nodes communicate?"></a>How do master nodes communicate?</h2></li>
</ul>
<p><strong>Cluster to master</strong></p>
<ul>
<li>All cluster -&gt; master communication only with apiserver</li>
<li>HTTPS (443)</li>
<li>Relatively secure</li>
</ul>
<p><strong>Master to cluster</strong></p>
<ul>
<li>apiserver-&gt;kubelet<ul>
<li>Certicate not verified by default</li>
<li>Vulnerable to man-in-the-middle attacks</li>
<li>Don’t run on public network</li>
<li>To harden<ul>
<li>set -kubelet-certificate-authority</li>
<li>use SSH tunelling</li>
</ul>
</li>
</ul>
</li>
<li>apiserver-&gt;nodes/pods/services<ul>
<li>Not safe</li>
<li>Plain HTTP</li>
<li>Neither authenticated for encrypted</li>
<li>On public clouds, SSH tunnelling provided by cloud provider e.g. GCP<h2 id="Where-can-we-run-Kubernetes"><a href="#Where-can-we-run-Kubernetes" class="headerlink" title="Where can we run Kubernetes?"></a>Where can we run Kubernetes?</h2>Public Cloud: </li>
</ul>
</li>
<li>aws(kops)</li>
<li>azure </li>
<li>gcp(kubectl)<ul>
<li>GKE:Google Kubernetes Engine</li>
<li>Infra on GCE Virtual machines</li>
<li>GCE: Google Compute Engine (IaaS)<br>Bootstrap(kubeadm): On-prem, private cloud<br>Playgrounds:PWK(Browser-based,time-limited sessions), Minikube(Windows or Mac, Sets up VM on your machine)</li>
</ul>
</li>
</ul>
<h2 id="Can-K8s-be-used-in-a-hybird-multi-cloud-world"><a href="#Can-K8s-be-used-in-a-hybird-multi-cloud-world" class="headerlink" title="Can K8s be used in a hybird, multi-cloud world?"></a>Can K8s be used in a hybird, multi-cloud world?</h2><p>Hybrid=On-prem+Public Cloud</p>
<ul>
<li>On-premise: vare metal or VMs</li>
<li>Legacy infra, large on-prem datacenters</li>
<li>Medium-term importance</li>
</ul>
<p>Multi-Cloud</p>
<ul>
<li>More than 1 public cloud provider</li>
<li>Strategic reasons, vendor lock-in (Amazon buying Whole Foods)</li>
</ul>
<h2 id="Interacting-with-K8s"><a href="#Interacting-with-K8s" class="headerlink" title="Interacting with K8s"></a>Interacting with K8s</h2><p><strong>How do we work with k8s</strong></p>
<ul>
<li>kubectl<ul>
<li>Most common command line utility</li>
<li>Make POST requests to apiserver of control plane</li>
</ul>
</li>
<li>kubeadm<ul>
<li>Bootstrap cluster when not on cloud Kubernetes service</li>
<li>To create cluster out of individual infra nodes</li>
</ul>
</li>
<li>kubefed<ul>
<li>Administer federated clusters</li>
<li>Federated cluster-&gt; group of multiple clusters (multi-cloud,hybrid)</li>
</ul>
</li>
<li>kubelet</li>
<li>kube-proxy</li>
</ul>
<p><strong>Objects</strong></p>
<ul>
<li>K8s objects are persistent entities</li>
<li>Everything is an object…</li>
<li>Pod,ReplicaSet, Deployment, Node … all are objects</li>
<li>Send object specification (usually in .yaml or .json)</li>
</ul>
<p><strong>Three object management methods</strong></p>
<ul>
<li>Imperative commands<ul>
<li>No .yaml or config files</li>
<li>kubectl run …</li>
<li>kubectl expose …</li>
<li>kubectl autosacle …<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl run ningx --image nginx</span><br><span class="line">kubectl create deployment nginx --image nginx</span><br></pre></td></tr></table></figure>
No config file</li>
</ul>
</li>
</ul>
<p>Imperative: intent is in command</p>
<p>Pro:</p>
<ul>
<li>Simple<br>Cons:</li>
<li>No audit trail or review mechanism</li>
<li>Can’t reuse or use in template</li>
</ul>
<ul>
<li>Imperative object configuration<ul>
<li>kubectl + yaml or config files used</li>
<li>kubectl create -f config.yaml</li>
<li>kubectl replace -f config.yaml</li>
<li>kubectl delete -f config.yaml</li>
</ul>
</li>
</ul>
<p>Config file required<br>Still Imperative: intent is in command</p>
<p>Pros:</p>
<ul>
<li>Still simple</li>
<li>Robust - files checked into repo</li>
<li>One file for multiple operations</li>
</ul>
<ul>
<li>Declarative object configuration<ul>
<li>Only .yaml or config files used</li>
<li>kubectl apply -f config.yaml<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f configs&#x2F;</span><br></pre></td></tr></table></figure>
Config files(s) are all that is required<br>Declarative not imperative</li>
</ul>
</li>
</ul>
<p>Pros:</p>
<ul>
<li><p>Most robust-review, repos, audit trails</p>
</li>
<li><p>K8S will automatically figure out intents</p>
</li>
<li><p>Can specify multiple files/directories recursively</p>
</li>
<li><p>Live object configuration: The live configuration values of an object, as observed by the Kubernetes cluster</p>
</li>
<li><p>Current object configuration files: The config file we are applying in the current command</p>
</li>
<li><p>List-applied object configuration file: The last config file what was applied to the object</p>
</li>
</ul>
<p><em>Don’t mix and match!</em><br><em>Declarative is preferred</em></p>
<p><strong>Merging Changes</strong></p>
<ul>
<li>Primitive fields<ul>
<li>String, init, boolean, images or replicas</li>
<li>Replace old state with Current object configuration file</li>
</ul>
</li>
<li>Map fields<ul>
<li>Merge old state with Current object configuration file</li>
</ul>
</li>
<li>List field<ul>
<li>Complex-varies by field</li>
</ul>
</li>
</ul>
<p><strong>The Pros and Cons of Declarative and Imperative object management</strong><br>Declarative</p>
<p>kubectl apply -f config.yaml</p>
<ul>
<li>Robust</li>
<li>Track in repos, review</li>
<li>Recursively apply to directories</li>
</ul>
<p>Imperative<br>kubectl run …<br>kubectl expose…<br>kubectl autosacle…</p>
<ul>
<li>Simple, intention is very clear</li>
<li>Preferred for deletion</li>
</ul>
<h2 id="Names-and-UIDs"><a href="#Names-and-UIDs" class="headerlink" title="Names and UIDs"></a>Names and UIDs</h2><p><strong>How are objects named?</strong></p>
<ul>
<li>Objects-persistent entities<ul>
<li>pods,replicasets,services,volumes,nodes,…</li>
<li>information maintained in etcd</li>
</ul>
</li>
<li>Identified using<ul>
<li>names: client-given</li>
<li>UIDs: system-generated<h2 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a>Namespaces</h2></li>
</ul>
</li>
<li>Divide physical cluster into multiple virtual clusters</li>
<li>Three pre-defined namespaces:<ul>
<li>default: if non specified</li>
<li>kube-system: for internal k8s objects</li>
<li>kub-public: auto-readable by all users</li>
</ul>
</li>
<li>Name scopes: names need to be unique only inside a namespace</li>
<li>Future version: namespace-&gt; common access control</li>
<li>Don’t use namespaces for versioning<ul>
<li>Just use labels instead</li>
</ul>
</li>
</ul>
<p><strong>Objects without namespaces</strong></p>
<ul>
<li>Nodes</li>
<li>PersistentVolumes</li>
<li>Namespace themselves</li>
</ul>
<h2 id="Labels"><a href="#Labels" class="headerlink" title="Labels"></a>Labels</h2><ul>
<li>key/value pairs attached to objects</li>
<li>metadata</li>
<li>need not be unique (same label to mutiple objects)</li>
<li>No sematics for k8s (meaningful only to humans)</li>
<li>Loose coupling via selectors</li>
<li>Can be added<ul>
<li>at creation time</li>
<li>after creation</li>
</ul>
</li>
<li>Multiple objects can have same label</li>
<li>Same label can’t repeat key though</li>
</ul>
<h2 id="Volumes"><a href="#Volumes" class="headerlink" title="Volumes"></a>Volumes</h2><ul>
<li>Permanence: Storage that lasts longer than lifetime of a pod<ul>
<li>a container inside pod (true for all volumes)</li>
<li>a pod (only true for persistent volumes)</li>
</ul>
</li>
<li>Shared State: multiple containers in a pod need to share state/files</li>
<li>Volumes: address both these needs</li>
<li>Volumes (in general): lifetime of abstraction=lifetime of pod<ul>
<li>Note that this is longer than lifetime of any container inside pod</li>
</ul>
</li>
<li>Persistent Volumes: lifetime of abstraction independent of pod lifetime<br><img src="https://i.imgur.com/0DJ10wq.png" alt="using volume"></li>
</ul>
<p><strong>Types of Volumes</strong></p>
<ul>
<li>awsElasticBlockStore</li>
<li>azureDisk</li>
<li>azureFile</li>
<li>gcePersistentDisk</li>
<li>Many non-cloud-specific volume types as well</li>
</ul>
<p><strong>Important type of volumes</strong></p>
<ul>
<li>configMap</li>
<li>emptyDir</li>
<li>gitRepo</li>
<li>secret</li>
<li>hostPath<h2 id="Lab-Volumes-and-the-exmptydir-volume"><a href="#Lab-Volumes-and-the-exmptydir-volume" class="headerlink" title="Lab: Volumes and the exmptydir volume"></a>Lab: Volumes and the exmptydir volume</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ cat pod-redis.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">   name: redis</span><br><span class="line">spec:</span><br><span class="line">   containers:</span><br><span class="line">   - name: redis</span><br><span class="line">     image: redis</span><br><span class="line">     volumeMounts:</span><br><span class="line">     - name: redis-storage</span><br><span class="line">       mountPath: &#x2F;data&#x2F;redis</span><br><span class="line">   volumes:</span><br><span class="line">   - name: redis-storage</span><br><span class="line">     emptyDir: &#123;&#125;</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod redis --watch        NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">redis   0&#x2F;1     Pending   0          7m36s</span><br><span class="line">redis   0&#x2F;1   Pending   0     7m36s</span><br><span class="line">redis   0&#x2F;1   ContainerCreating   0     7m36s</span><br><span class="line">redis   1&#x2F;1   Running   0     7m40s</span><br><span class="line">^Cstancloud9@cloudshell:~ (scenic-torch-250909)$ k exec -it redis -- &#x2F;bin&#x2F;bash</span><br><span class="line">root@redis:&#x2F;data# cd &#x2F;data&#x2F;redis</span><br><span class="line">root@redis:&#x2F;data&#x2F;redis# echo Hello &gt; test-file</span><br><span class="line">root@redis:&#x2F;data&#x2F;redis# kill 1</span><br><span class="line">root@redis:&#x2F;data&#x2F;redis# command terminated with exit code 137</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod redis --watch</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">redis   1&#x2F;1     Running   1          18m</span><br><span class="line">^Cstancloud9@cloudshell:~ (scenic-torch-250909)$ k exec -it redis -- &#x2F;bin&#x2F;bash</span><br><span class="line">root@redis:&#x2F;data# ls &#x2F;data&#x2F;redis</span><br><span class="line">test-file</span><br></pre></td></tr></table></figure>
<h2 id="Persistent-Volumes"><a href="#Persistent-Volumes" class="headerlink" title="Persistent Volumes"></a>Persistent Volumes</h2></li>
<li>Low-level objects, like nodes</li>
<li>Two types of provisioning:</li>
<li>Static: administrator pre-creates the volumes</li>
<li>Dynamic: containers need to file a PersistentVolumeClaim<br><img src="https://i.imgur.com/Yk4bu0J.png" alt="Cloud specific persistent volumes"><br><img src="https://i.imgur.com/KnjqWkU.png" alt="persisten volumes"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">gcloud compute disks create my-disk-1 --zone australia-southeast1-a</span><br><span class="line">gcloud compute disks list</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ cat volum-sample.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: test-pd</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: k8s.gcr.io&#x2F;test-webserver</span><br><span class="line">    name: test-container</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: &#x2F;test-pd</span><br><span class="line">      name: test-volume</span><br><span class="line">  volumes:</span><br><span class="line">  - name: test-volume</span><br><span class="line">    gcePersistentDisk:</span><br><span class="line">      pdName: my-disk-1</span><br><span class="line">      fsType: ext4</span><br><span class="line">k create -f volum-sample.yaml --validate&#x3D;false</span><br><span class="line">pod&#x2F;test-pd created</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod test-pd --watch</span><br><span class="line">NAME      READY   STATUS              RESTARTS   AGE</span><br><span class="line">test-pd   0&#x2F;1     ContainerCreating   0          23s</span><br><span class="line">test-pd   1&#x2F;1   Running   0     29s</span><br><span class="line">^Cstancloud9@cloudshell:~ (scenic-torch-250909)$ k describe pod test-pd</span><br><span class="line">Name:               test-pd</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               gke-my-first-cluster-default-pool-8ca613e9-w13m&#x2F;10.152.0.2</span><br><span class="line">Start Time:         Sat, 31 Aug 2019 11:39:22 +1000</span><br><span class="line">Labels:             &lt;none&gt;</span><br><span class="line">Annotations:        kubernetes.io&#x2F;limit-ranger: LimitRanger plugin set: cpu request for container test-container</span><br><span class="line">Status:             Running</span><br><span class="line">IP:                 10.24.0.22</span><br><span class="line">Containers:</span><br><span class="line">  test-container:</span><br><span class="line">    Container ID:   docker:&#x2F;&#x2F;8b08b4cd144d256a078fe3c7b4031844e2c3355d854a711ec454611c0edea30b</span><br><span class="line">    Image:          k8s.gcr.io&#x2F;test-webserver</span><br><span class="line">    Image ID:       docker-pullable:&#x2F;&#x2F;k8s.gcr.io&#x2F;test-webserver@sha256:f63e365c13646f231ec4a16791c6133ddd7b80fcd1947f41ab193968e02b0745</span><br><span class="line">    Port:           &lt;none&gt;</span><br><span class="line">    Host Port:      &lt;none&gt;</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Sat, 31 Aug 2019 11:39:50 +1000</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:        100m</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      &#x2F;test-pd from test-volume (rw)</span><br><span class="line">      &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount from default-token-gw57h (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  test-volume:</span><br><span class="line">    Type:       GCEPersistentDisk (a Persistent Disk resource in Google Compute Engine)</span><br><span class="line">    PDName:     my-disk-1</span><br><span class="line">    FSType:     ext4</span><br><span class="line">    Partition:  0</span><br><span class="line">    ReadOnly:   false</span><br><span class="line">  default-token-gw57h:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-gw57h</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       Burstable</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io&#x2F;not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io&#x2F;unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason                  Age    From                                                      Message</span><br><span class="line">  ----    ------                  ----   ----                                                      -------</span><br><span class="line">  Normal  Scheduled               2m15s  default-scheduler                                         Successfully assigned default&#x2F;test-pd to gke-my-first-cluster-default-pool-8ca613e9-w13m</span><br><span class="line">  Normal  SuccessfulAttachVolume  2m9s   attachdetach-controller                                   AttachVolume.Attach succeeded for volume &quot;test-volume&quot;</span><br><span class="line">  Normal  Pulling                 109s   kubelet, gke-my-first-cluster-default-pool-8ca613e9-w13m  pulling image &quot;k8s.gcr.io&#x2F;test-webserver&quot;</span><br><span class="line">  Normal  Pulled                  107s   kubelet, gke-my-first-cluster-default-pool-8ca613e9-w13m  Successfully pulled image &quot;k8s.gcr.io&#x2F;test-webserver&quot;</span><br><span class="line">  Normal  Created                 107s   kubelet, gke-my-first-cluster-default-pool-8ca613e9-w13m  Created container</span><br><span class="line">  Normal  Started                 107s   kubelet, gke-my-first-cluster-default-pool-8ca613e9-w13m  Started container</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>What are some important types of volumes?</strong></p>
<ul>
<li><p>emptyDir</p>
<ul>
<li>Not persistent</li>
<li>Created when pod is created on node</li>
<li>Initially empty</li>
<li>Share space/state across containers in same pod</li>
<li>Containers acan mount at different times</li>
<li>When pod removed/crashes, data lost</li>
<li>When container carshes data remains</li>
<li>Usecases: Scratch space, checkpointing…<br><img src="https://i.imgur.com/GGAyCl0.png" alt="emptyDir"></li>
</ul>
</li>
<li><p>hostPath<br><img src="https://i.imgur.com/pzfvzAb.png" alt="hostPath"></p>
<ul>
<li>Mount file/directory from node filesystem into pod</li>
<li>Uncommon- pods should be independent of nodes</li>
<li>Makes pod-node coupling tight</li>
<li>Usecases: Access docker internals, running cAdvisor</li>
<li>Block devices or sockets on host</li>
</ul>
</li>
<li><p>gitRepo<br><img src="https://i.imgur.com/EPHpRzS.png" alt="gitRepo"></p>
</li>
<li><p>configMap<br><img src="https://i.imgur.com/GkC7kjP.png" alt="conigMap"></p>
<ul>
<li>configMap volume mounts data from ConfigMap object</li>
<li>configMap objects define key-value pairs</li>
<li>configMap objects inject paramters into pods</li>
<li>Two main usecases:<ul>
<li>Providing config information for apps running inside pods</li>
<li>Specifying config information for control plane (controllers)</li>
</ul>
</li>
</ul>
</li>
<li><p>secret</p>
<ul>
<li>Pass ensitive inforamtion to pods</li>
<li>First create secret so it is stored in control plane<ul>
<li>kubectl create secret</li>
</ul>
</li>
<li>Mount that secret as a volume so that it is available inside pod</li>
<li>Secret is stored in RAM storage (not written to persistent disk)<h2 id="Lab-use-of-secrets-pass-information-to-pods"><a href="#Lab-use-of-secrets-pass-information-to-pods" class="headerlink" title="Lab: use of secrets pass information to pods"></a>Lab: use of secrets pass information to pods</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ cat secrets.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: test-secret</span><br><span class="line">data:</span><br><span class="line">  username: bXktYMxw</span><br><span class="line">  password: Mzk1MjqkdmRnN0pi</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ cat secrets-pod.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: secret-test-pod</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">    - name: test-container</span><br><span class="line">      image: nginx</span><br><span class="line">      volumeMounts:</span><br><span class="line">         # name must match the volume name below</span><br><span class="line">         - name: secret-volume</span><br><span class="line">           mountPath: &#x2F;etc&#x2F;secret-volume</span><br><span class="line">  # The secret data is exposed to Containers in the Pod through a Volume.</span><br><span class="line">  volumes:</span><br><span class="line">    - name: secret-volume</span><br><span class="line">      secret:</span><br><span class="line">        secretName: test-secret</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod secret-test-pod</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">secret-test-pod   1&#x2F;1     Running   0          19m</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k exec -it secret-test-pod -- &#x2F;bin&#x2F;bash</span><br><span class="line">root@secret-test-pod:&#x2F;# cd &#x2F;etc&#x2F;secret-volume&#x2F;</span><br><span class="line">root@secret-test-pod:&#x2F;etc&#x2F;secret-volume# ls</span><br><span class="line">password  username</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="Debugging"><a href="#Debugging" class="headerlink" title="Debugging"></a>Debugging</h1><h2 id="Insufficient-cpu"><a href="#Insufficient-cpu" class="headerlink" title="Insufficient cpu"></a>Insufficient cpu</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod secret-test-pod</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">secret-test-pod   0&#x2F;1     Pending   0          51s</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k describe pod secret-test-pod</span><br><span class="line">Name:               secret-test-pod</span><br><span class="line">Namespace:          default</span><br><span class="line">Priority:           0</span><br><span class="line">PriorityClassName:  &lt;none&gt;</span><br><span class="line">Node:               &lt;none&gt;</span><br><span class="line">Labels:             &lt;none&gt;</span><br><span class="line">Annotations:        kubernetes.io&#x2F;limit-ranger: LimitRanger plugin set: cpu request for container test-container</span><br><span class="line">Status:             Pending</span><br><span class="line">IP:</span><br><span class="line">Containers:</span><br><span class="line">  test-container:</span><br><span class="line">    Image:      nginx</span><br><span class="line">    Port:       &lt;none&gt;</span><br><span class="line">    Host Port:  &lt;none&gt;</span><br><span class="line">    Requests:</span><br><span class="line">      cpu:        100m</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      &#x2F;etc&#x2F;secret-volume from secret-volume (rw)</span><br><span class="line">      &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount from default-token-gw57h (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status</span><br><span class="line">  PodScheduled   False</span><br><span class="line">Volumes:</span><br><span class="line">  secret-volume:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  test-secret</span><br><span class="line">    Optional:    false</span><br><span class="line">  default-token-gw57h:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-gw57h</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       Burstable</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io&#x2F;not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io&#x2F;unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type     Reason            Age                  From               Message</span><br><span class="line">  ----     ------            ----                 ----               -------</span><br><span class="line">  Warning  FailedScheduling  11s (x8 over 4m25s)  default-scheduler  0&#x2F;1 nodes are available: 1 Insufficient cpu.</span><br><span class="line"></span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ gcloud container clusters resize my-first-cluster --num-nodes&#x3D;3 --zone australia-southeast1-a</span><br><span class="line">Pool [default-pool] for [my-first-cluster] will be resized to 3.</span><br><span class="line"></span><br><span class="line">Do you want to continue (Y&#x2F;n)?  Y</span><br><span class="line"></span><br><span class="line">Resizing my-first-cluster...done.</span><br><span class="line">Updated [https:&#x2F;&#x2F;container.googleapis.com&#x2F;v1&#x2F;projects&#x2F;scenic-torch-250909&#x2F;zones&#x2F;australia-southeast1-a&#x2F;clusters&#x2F;my-first-cluster].</span><br><span class="line">stancloud9@cloudshell:~ (scenic-torch-250909)$ k get pod secret-test-pod</span><br><span class="line">NAME              READY   STATUS    RESTARTS   AGE</span><br><span class="line">secret-test-pod   1&#x2F;1     Running   0          19m</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/devops/">devops</a><a href="/tags/k8s/">k8s</a><a href="/tags/GKE/">GKE</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/09/06/redhat/" title="redhat" itemprop="url">redhat</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2017-09-06T07:49:54.000Z" itemprop="datePublished"> Published 2017-09-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Issue-1"><a href="#Issue-1" class="headerlink" title="Issue 1."></a>Issue 1.</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost stan]<span class="comment"># yum install -y ntp</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">There are no enabled repos.</span><br><span class="line"> Run <span class="string">&quot;yum repolist all&quot;</span> to see the repos you have.</span><br><span class="line"> You can <span class="built_in">enable</span> repos with yum-config-manager --<span class="built_in">enable</span> &lt;repo&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Solve"><a href="#Solve" class="headerlink" title="Solve:"></a>Solve:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /cdrom</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># pwd</span></span><br><span class="line">/etc/yum.repos.d</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vim dvd.repo</span></span><br><span class="line">[dvd-source]</span><br><span class="line">name=RHEL 7.2 dvd repo</span><br><span class="line">baseurl=file:///cdrom</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum repolist</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">dvd-source                                                                                     | 4.1 kB  00:00:00</span><br><span class="line">(1/2): dvd-source/group_gz                                                                     | 136 kB  00:00:00</span><br><span class="line">(2/2): dvd-source/primary_db                                                                   | 3.6 MB  00:00:00</span><br><span class="line">repo id                                             repo name                                                   status</span><br><span class="line">dvd-source                                          RHEL 7.2 dvd repo                                           4,620</span><br><span class="line">repolist: 4,620</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># yum install rpm-build</span></span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered to Red Hat Subscription Management. You can use subscription-manager to register.</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package rpm-build.x86_64 0:4.11.3-17.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: perl(Thread::Queue) <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Processing Dependency: system-rpm-config <span class="keyword">for</span> package: rpm-build-4.11.3-17.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package perl-Thread-Queue.noarch 0:3.02-2.el7 will be installed</span><br><span class="line">---&gt; Package redhat-rpm-config.noarch 0:9.1.0-68.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: dwz &gt;= 0.4 <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Processing Dependency: perl-srpm-macros <span class="keyword">for</span> package: redhat-rpm-config-9.1.0-68.el7.noarch</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package dwz.x86_64 0:0.11-3.el7 will be installed</span><br><span class="line">---&gt; Package perl-srpm-macros.noarch 0:1-8.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">======================================================================================================================</span><br><span class="line"> Package                          Arch                  Version                       Repository                 Size</span><br><span class="line">======================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> rpm-build                        x86_64                4.11.3-17.el7                 dvd-source                144 k</span><br><span class="line">Installing <span class="keyword">for</span> dependencies:</span><br><span class="line"> dwz                              x86_64                0.11-3.el7                    dvd-source                 99 k</span><br><span class="line"> perl-Thread-Queue                noarch                3.02-2.el7                    dvd-source                 17 k</span><br><span class="line"> perl-srpm-macros                 noarch                1-8.el7                       dvd-source                4.7 k</span><br><span class="line"> redhat-rpm-config                noarch                9.1.0-68.el7                  dvd-source                 77 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">======================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 341 k</span><br><span class="line">Installed size: 734 k</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                 1.9 MB/s | 341 kB  00:00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : perl-Thread-Queue-3.02-2.el7.noarch                                                                1/5</span><br><span class="line">  Installing : dwz-0.11-3.el7.x86_64                                                                              2/5</span><br><span class="line">  Installing : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Installing : redhat-rpm-config-9.1.0-68.el7.noarch                                                              4/5</span><br><span class="line">  Installing : rpm-build-4.11.3-17.el7.x86_64                                                                     5/5</span><br><span class="line">dvd-source/productid                                                                           | 1.6 kB  00:00:00</span><br><span class="line">  Verifying  : redhat-rpm-config-9.1.0-68.el7.noarch                                                              1/5</span><br><span class="line">  Verifying  : rpm-build-4.11.3-17.el7.x86_64                                                                     2/5</span><br><span class="line">  Verifying  : perl-srpm-macros-1-8.el7.noarch                                                                    3/5</span><br><span class="line">  Verifying  : dwz-0.11-3.el7.x86_64                                                                              4/5</span><br><span class="line">  Verifying  : perl-Thread-Queue-3.02-2.el7.noarch                                                                5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  rpm-build.x86_64 0:4.11.3-17.el7</span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  dwz.x86_64 0:0.11-3.el7                  perl-Thread-Queue.noarch 0:3.02-2.el7  perl-srpm-macros.noarch 0:1-8.el7</span><br><span class="line">  redhat-rpm-config.noarch 0:9.1.0-68.el7</span><br><span class="line"></span><br><span class="line">omplete!</span><br><span class="line"></span><br><span class="line">$(!!) to recompute the output of the last <span class="built_in">command</span></span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/redhat/">redhat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/nginx01/" title="Nginx Deploy" itemprop="url">Nginx Deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T04:31:14.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Install-Nginx"><a href="#Install-Nginx" class="headerlink" title="Install Nginx"></a>Install Nginx</h2><h3 id="Install-Nginx-Package"><a href="#Install-Nginx-Package" class="headerlink" title="Install Nginx Package"></a>Install Nginx Package</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@huoq bin]<span class="comment"># yum install pcre pcre-devel -y</span></span><br><span class="line">check by:</span><br><span class="line">[root@huoq bin]<span class="comment"># rpm -qa pcre pcre-devel</span></span><br><span class="line">pcre-devel-8.32-15.el7_2.1.x86_64</span><br><span class="line">pcre-8.32-15.el7_2.1.x86_64</span><br><span class="line">[root@huoq tools]<span class="comment"># yum install -y openssl-devel openssl</span></span><br></pre></td></tr></table></figure>

<h3 id="Install-Nginx-1"><a href="#Install-Nginx-1" class="headerlink" title="Install Nginx"></a>Install Nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.6.3.tar.gz</span><br><span class="line">useradd nginx -s /sbin/nologin -M</span><br><span class="line">tar xf nginx-1.6.3.tar.gz</span><br><span class="line"><span class="built_in">cd</span> nginx-1.6.3/</span><br><span class="line">./configure --user=nginx --group=nginx --prefix=/application/nginx-1.6.3 --with-http_stub_status_module --with-http_ssl_module</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ln -s /application/nginx-1.6.3 /application/nginx</span><br><span class="line">vim /application/nginx/conf/nginx.conf</span><br><span class="line">worker_processes  4;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">   </span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream web_pools &#123;</span><br><span class="line">        server 127.0.0.1:8081;</span><br><span class="line">        server 127.0.0.1:8082;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">            proxy_pass http://web_pools;</span><br><span class="line">        &#125;</span><br><span class="line">        location /nginx_status &#123;</span><br><span class="line">                stub_status on;</span><br><span class="line">                access_log off;</span><br><span class="line">                allow 127.0.0.1;</span><br><span class="line">                deny all;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        <span class="comment"># redirect server error pages to the static page /50x.html</span></span><br><span class="line">        <span class="comment">#</span></span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">/application/nginx/sbin/nginx -t</span><br><span class="line">vim /etc/init.d/nginx</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#chkconfig: - 85 15</span></span><br><span class="line"><span class="comment">#description: this script use to manage nginx process.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#set -x</span></span><br><span class="line">. /etc/rc.d/init.d/<span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">procnum=`ps -ef |grep <span class="string">&quot;/application/nginx/sbin/nginx&quot;</span>|grep -v <span class="string">&quot;grep&quot;</span>|wc -l`</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">start</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$procnum</span>&quot;</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Starting nginx:&quot;</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  /application/nginx/sbin/nginx</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Starting nginx:&quot;</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Starting nginx:&quot;</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 4</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$procnum</span>&quot;</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s stop</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;$?&quot;</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Stopping nginx:&quot;</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Stopping nginx:&quot;</span></span><br><span class="line">  failure</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="built_in">exit</span> 3</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> -n <span class="string">&quot;Stopping nginx:&quot;</span></span><br><span class="line">  success</span><br><span class="line">  <span class="built_in">echo</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">  start)</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  stop)</span><br><span class="line">  stop</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  restart)</span><br><span class="line">  stop</span><br><span class="line">  sleep 1</span><br><span class="line">  start</span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  reload)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$procnum</span>&quot;</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  /application/nginx/sbin/nginx -s reload</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;nginx is not running!please start nginx first...&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 2</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  status)</span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$procnum</span>&quot;</span> -eq 1 -a -f /application/nginx/logs/nginx.pid ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;nginx is running...&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;nginx is not running...&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  ;;</span><br><span class="line"></span><br><span class="line">  *)</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Usage : nginx [ start|stop|reload|restart|status ]&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">chmod +x /etc/init.d/nginx</span><br><span class="line">chkconfig nginx on</span><br><span class="line">/etc/init.d/nginx start</span><br><span class="line">Starting nginx:                                      [  OK  ]</span><br><span class="line">/etc/init.d/nginx status</span><br><span class="line">nginx is running...</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Written with <a target="_blank" rel="noopener" href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/27/tomcat01/" title="tomcat deploy" itemprop="url">tomcat deploy</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-27T00:10:37.000Z" itemprop="datePublished"> Published 2016-10-27</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="tomcat-deploy-on-centos"><a href="#tomcat-deploy-on-centos" class="headerlink" title="tomcat deploy on centos"></a>tomcat deploy on centos</h2><h2 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h2><h3 id="JDK下载："><a href="#JDK下载：" class="headerlink" title="JDK下载："></a>JDK下载：</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget --no-check-certificate --no-cookies --header <span class="string">&quot;Cookie: oraclelicense=accept-securebackup-cookie&quot;</span> http://download.oracle.com/otn-pub/java/jdk/7u79-b15/jdk-7u79-linux-x64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat下载"><a href="#Tomcat下载" class="headerlink" title="Tomcat下载:"></a><a target="_blank" rel="noopener" href="http://tomcat.apache.org/">Tomcat下载</a>:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget ftp://toad.cwzhou.win/pub/apache-tomcat-7.0.70.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="部署java环境"><a href="#部署java环境" class="headerlink" title="部署java环境"></a>部署java环境</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tar xf jdk-8u91-linux-x64.tar.gz -C /application/</span><br><span class="line"></span><br><span class="line">ln -s /application/jdk1.8.0/ /application/jdk</span><br><span class="line">cp /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="comment"># sed -i.ori &#x27;$a export JAVA_HOME=/application/jdk\nexport PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH\nexport CLASSPATH=.$CLASSPATH:$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/lib/tools.jar&#x27; /etc/profile</span></span><br><span class="line"></span><br><span class="line">vimdiff /etc/profile /etc/profile.2016.6.29</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h2 id="Install-tomcat"><a href="#Install-tomcat" class="headerlink" title="Install tomcat"></a>Install tomcat</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tar xf apache-tomcat-8.0.27.tar.gz -C /application/</span><br><span class="line">ln -s /application/apache-tomcat-8.0.27 /application/tomcat</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&#x27;export TOMCAT_HOME=/application/tomcat&#x27;</span>&gt;&gt;/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">chown -R root.root /application/jdk/ /application/tomcat/</span><br><span class="line">[root@tomcat ~]<span class="comment"># tail -4 /etc/profile</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>/jre/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.<span class="variable">$CLASSPATH</span>:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JAVA_HOME</span>/jre/lib:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/application/tomcat</span><br></pre></td></tr></table></figure>
<h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/tomcat/</span></span><br><span class="line">[root@tomcat tomcat]<span class="comment"># tree -L 1</span></span><br><span class="line">.</span><br><span class="line">├── bin <span class="comment">#→用以启动、关闭Tomcat或者其它功能的脚本（.bat文件和.sh文件）</span></span><br><span class="line">├── conf <span class="comment">#→用以配置Tomcat的XML及DTD文件</span></span><br><span class="line">├── lib <span class="comment">#→存放web应用能访问的JAR包</span></span><br><span class="line">├── LICENSE</span><br><span class="line">├── logs <span class="comment">#→Catalina和其它Web应用程序的日志文件</span></span><br><span class="line">├── NOTICE</span><br><span class="line">├── RELEASE-NOTES</span><br><span class="line">├── RUNNING.txt</span><br><span class="line">├── temp <span class="comment">#→临时文件</span></span><br><span class="line">├── webapps <span class="comment">#→Web应用程序根目录</span></span><br><span class="line">└── work <span class="comment">#→用以产生有JSP编译出的Servlet的.java和.class文件</span></span><br><span class="line">7 directories, 4 files</span><br><span class="line">[root@tomcat tomcat]<span class="comment"># cd webapps/</span></span><br><span class="line">[root@tomcat webapps]<span class="comment"># ll</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 14 root root 4096 Oct 5 12:09 docs <span class="comment">#→tomcat帮助文档</span></span><br><span class="line">drwxr-xr-x 6 root root 4096 Oct 5 12:09 examples <span class="comment">#→web应用实例</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 host-manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 5 root root 4096 Oct 5 12:09 manager <span class="comment">#→管理</span></span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 5 12:09 ROOT <span class="comment">#→默认网站根目录</span></span><br></pre></td></tr></table></figure>

<h2 id="Tomcat多实例及集群架构"><a href="#Tomcat多实例及集群架构" class="headerlink" title="Tomcat多实例及集群架构"></a>Tomcat多实例及集群架构</h2><h3 id="Tomcat多实例"><a href="#Tomcat多实例" class="headerlink" title="Tomcat多实例"></a>Tomcat多实例</h3><p>复制Tomcat目录</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat ~]<span class="comment"># cd /application/</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_1</span></span><br><span class="line"> [root@yoshi application]<span class="comment"># cp -a apache-tomcat-7.0.70 tomcat7_2</span></span><br></pre></td></tr></table></figure>
<p>修改配置文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@tomcat application]<span class="comment"># mkdir -p /data/www/www/ROOT</span></span><br><span class="line">[root@tomcat application]<span class="comment"># cp /application/tomcat/webapps/memtest/meminfo.jsp /data/www/www/ROOT/</span></span><br><span class="line">sed -i <span class="string">&#x27;22s#8005#8011#;71s#8080#8081#;125s#appBase=&quot;.*&quot;# appBase=&quot;/data/www/www&quot;#&#x27;</span> /application/tomcat7_1/conf/server.xml</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;22s#8005#8012#;71s#8080#8082#;125s#appBase=&quot;.*&quot;# appBase=&quot;/data/www/www&quot;#&#x27;</span> /application/tomcat7_2/conf/server.xml</span><br></pre></td></tr></table></figure>
<h3 id="jvm调优"><a href="#jvm调优" class="headerlink" title="jvm调优"></a>jvm调优</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim catalina.sh insert</span></span><br><span class="line">JAVA_OPTS=<span class="string">&quot;-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m -Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m -XX:MaxPermSize=512m&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="service-startup-script"><a href="#service-startup-script" class="headerlink" title="service startup script"></a>service startup script</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/init.d</span><br><span class="line"></span><br><span class="line">vim tomcat</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># des: Tomcat Start Stop Restart</span></span><br><span class="line"><span class="comment"># processname: tomcat</span></span><br><span class="line"><span class="comment"># chkconfig: 234 20 80</span></span><br><span class="line">JAVA_HOME=/application/jdk</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME</span><br><span class="line">PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> PATH</span><br><span class="line">CATALINA_HOME=/application/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">sh /application/tomcat7_1/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_1/bin/startup.sh</span><br><span class="line">sh /application/tomcat7_2/bin/shutdown.sh</span><br><span class="line">sh /application/tomcat7_2/bin/startup.sh</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line"></span><br><span class="line">chkconfig --add tomcat</span><br><span class="line">chkconfig --level 234 tomcat on</span><br><span class="line">chkconfig --list tomcat</span><br><span class="line">groupadd tomcat</span><br><span class="line">useradd -g tomcat -d /home/tomcat -s /bin/sh tomcat</span><br><span class="line"><span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"></span><br><span class="line">chown tomcat:tomcat  tomcat</span><br><span class="line"></span><br><span class="line">chmod +x tomcat</span><br><span class="line">service tomcat start</span><br><span class="line"></span><br><span class="line">check the <span class="built_in">log</span>:</span><br><span class="line">tail /application/tomcat/logs/catalina.out</span><br></pre></td></tr></table></figure>
<h3 id="Remove-default-content"><a href="#Remove-default-content" class="headerlink" title="Remove default content:"></a>Remove default content:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /root/apache-tomcat-7.0.70.tar.gz</span><br><span class="line">vim /tmp/run01.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> docs examples host-manager manager ROOT/RELEASE-NOTES.txt </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                rm -rf /application/tomcat7_<span class="variable">$i</span>/webapps/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="Change-folder-ownership-and-permissions"><a href="#Change-folder-ownership-and-permissions" class="headerlink" title="Change folder ownership and permissions:"></a>Change folder ownership and permissions:</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chown -R tomcat.tomcat /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run02.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> logs temp </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">vim /tmp/run03.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> bin webapps conf </span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;; <span class="keyword">do</span> chmod 770 /application/tomcat7_<span class="variable">$i</span>/conf/catalina.policy; <span class="keyword">done</span></span><br><span class="line">vim /tmp/run04.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..2&#125;</span><br><span class="line"> <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> catalina.properties context.xml logging.properties server.xml tomcat-users.xml web.xml</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">                chmod g-w,o-rwx /application/tomcat7_<span class="variable">$i</span>/conf/<span class="variable">$j</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line"> <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h3 id="Remove-Server-Banner"><a href="#Remove-Server-Banner" class="headerlink" title="Remove Server Banner"></a>Remove Server Banner</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /application/tomcat/lib</span><br><span class="line">mkdir -p org/apache/catalina/util/</span><br><span class="line">jar xf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">ll org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">vim org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">server.info=Secure Web server</span><br><span class="line">server.number=1.0.0.0</span><br><span class="line">server.built=Jan 01 2000 00:00:00 UTC</span><br><span class="line">jar uf catalina.jar org/apache/catalina/util/ServerInfo.properties</span><br><span class="line">rm -rf /application/tomcat/lib/org</span><br></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/tomcat/">tomcat</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/17/nginx/" title="optimize nginx performance" itemprop="url">optimize nginx performance</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-17T03:45:29.000Z" itemprop="datePublished"> Published 2016-10-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="1-优化worker进程个数"><a href="#1-优化worker进程个数" class="headerlink" title="1.优化worker进程个数"></a>1.优化worker进程个数</h3><p>查看cpu总核数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep processor /proc/cpuinfo|wc -l</span></span><br><span class="line">2 <span class="comment">#表示为1颗CPU四核</span></span><br></pre></td></tr></table></figure>
<p>查看CPU总颗数：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># grep &#x27;physical id&#x27; /proc/cpuinfo|sort|uniq|wc -l</span></span><br><span class="line">1 <span class="comment">#对physical id去重计数，表示1颗cpu</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim nginx.conf</span></span><br><span class="line">worker_processes 2;</span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -t</span></span><br><span class="line"><span class="comment"># /application/nginx/sbin/nginx -s reload</span></span><br></pre></td></tr></table></figure>

<h3 id="2-访问日志配置实战"><a href="#2-访问日志配置实战" class="headerlink" title="2.访问日志配置实战"></a>2.访问日志配置实战</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">sed -n <span class="string">&#x27;21,23 s/#//gp&#x27;</span> ../conf/nginx.conf.default</span><br><span class="line">log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line"><span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">vim nginx.con</span><br><span class="line">error_log  logs/error.log;</span><br><span class="line">...</span><br><span class="line">http &#123;</span><br><span class="line">...</span><br><span class="line">log_format  main  <span class="string">&#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span></span><br><span class="line">		  <span class="string">&#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span></span><br><span class="line">		  <span class="string">&#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">access_log  logs/access.log  main;</span><br><span class="line">   </span><br><span class="line">...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>Nginx访问日志轮询切割</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /server/script/cut_nginx_log.sh</span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">Dateformat=`date +%Y%m%d`</span><br><span class="line">Basedir=<span class="string">&quot;/application/nginx&quot;</span></span><br><span class="line">Nginxlogdir=<span class="string">&quot;<span class="variable">$Basedir</span>/logs&quot;</span></span><br><span class="line">Logname=<span class="string">&quot;access&quot;</span></span><br><span class="line">[ -d <span class="variable">$Nginxlogdir</span> ] &amp;&amp; <span class="built_in">cd</span> <span class="variable">$Nginxlogdir</span> || <span class="built_in">exit</span> 1</span><br><span class="line">[ -f <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> ]|| exit1</span><br><span class="line">/bin/mv <span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span> <span class="variable">$&#123;Dateformat&#125;</span>_<span class="variable">$&#123;Logname&#125;</span>.<span class="built_in">log</span></span><br><span class="line"><span class="variable">$Basedir</span>/sbin/nginx -s reload</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /var/spool/cron/root &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">#cut nginx access log by cwzhou</span></span><br><span class="line"><span class="string">00 00 * * * /bin/sh /server/script/cut_nginx_log.sh &gt; /dev/null 2&gt;&amp;1</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#check result</span></span><br><span class="line"><span class="comment">#crontab -l</span></span><br></pre></td></tr></table></figure>
<h3 id="Nginx并发连接数量"><a href="#Nginx并发连接数量" class="headerlink" title="Nginx并发连接数量"></a>Nginx并发连接数量</h3><blockquote>
<p>Reference <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html">ngx_http_limit_conn_module</a><br>1.限制单ip并发连接数</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn addr 1; <span class="comment">#限制单ip的并发连接为1</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ab -c 1 -n 10 http://10.0.0.3/  <span class="comment">#模拟并发连接1,访问10次服务器</span></span><br><span class="line"><span class="comment"># -c为并发数 -n为请求书 10.0.0.3为nginx的Ip地址</span></span><br></pre></td></tr></table></figure>
<p>应用场景之一是服务器下载：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /download/ &#123;</span><br><span class="line">	limit_conn add 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.限制虚拟主机总连接数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim nginx.conf</span><br><span class="line">...</span><br><span class="line">http&#123;</span><br><span class="line">    ...</span><br><span class="line">    limit_conn_zone <span class="variable">$binary_remote_addr</span> zone=addr:10m;</span><br><span class="line">    limit_conn_zone <span class="variable">$server_name</span> zone=perserver:10m;</span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">	...</span><br><span class="line">	location / &#123;</span><br><span class="line">		...</span><br><span class="line">		limit_conn perserver 2; <span class="comment">#限制虚拟主机连接数为2</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/centos/">centos</a><a href="/tags/nginx/">nginx</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/13/sysadmintool/" title="system admin tools" itemprop="url">system admin tools</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-13T05:23:04.000Z" itemprop="datePublished"> Published 2016-10-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="system-admin-tool"><a href="#system-admin-tool" class="headerlink" title="system admin tool"></a>system admin tool</h2><p><a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-10915175-id-3246219.html%22iostat%E4%BB%8B%E7%BB%8D%22">iostat介绍</a><br><a target="_blank" rel="noopener" href="http://blog.chinaunix.net/uid-10915175-id-4543091.html">全能系统监控工具dstat </a><br>most use: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@toad pxe]<span class="comment"># dstat -cmsdnl -D sda3 -N lo,eth0 100 5</span></span><br></pre></td></tr></table></figure>
<p>网络监控工具<br>本地服务器的网卡吞吐量：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptraf -d eth0</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># both</span></span><br><span class="line">wget ftp://ftp.netperf.org/netperf/netperf-2.7.0.tar.gz</span><br><span class="line">tar xf netperf-2.7.0.tar.gz</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment">#服务端：</span></span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># netserver</span></span><br><span class="line">Starting netserver with host <span class="string">&#x27;IN(6)ADDR_ANY&#x27;</span> port <span class="string">&#x27;12865&#x27;</span> and family AF_UNSPEC</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># lsof -i :12865</span></span><br><span class="line">COMMAND     PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">netserver 18230 root    3u  IPv6 2815424      0t0  TCP *:12865 (LISTEN)</span><br><span class="line">[root@toad netperf-2.7.0]<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 1000Mb/s</span><br><span class="line"></span><br><span class="line"><span class="comment">#客户端</span></span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment">#  netperf -H 192.168.199.231 -l 60</span></span><br><span class="line">MIGRATED TCP STREAM TEST from 0.0.0.0 () port 0 AF_INET to 192.168.199.231 () port 0 AF_INET</span><br><span class="line">Recv   Send    Send</span><br><span class="line">Socket Socket  Message  Elapsed</span><br><span class="line">Size   Size    Size     Time     Throughput</span><br><span class="line">bytes  bytes   bytes    secs.    10^6bits/sec</span><br><span class="line"></span><br><span class="line">87380  16384  16384    60.02      94.13</span><br><span class="line">root@kali:~/Downloads/netperf-2.7.0<span class="comment"># ethtool eth0 |grep -i speed</span></span><br><span class="line">        Speed: 100Mb/s</span><br></pre></td></tr></table></figure>
<p>Netperf缺省情况下进行TCP批量传输，即-t TCP_STREAM。测试过程中，netperf向netserver发送批量的TCP数据分组，以确定数据传输过程中的吞吐量：<br> 从netperf的结果输出中，我们可以知道以下的一些信息：<br>1）    远端系统（即server）使用大小为87380字节的socket接收缓冲<br>2）    本地系统（即client）使用大小为16384字节的socket发送缓冲<br>3）    向远端系统发送的测试分组大小为16384字节<br>4）    测试经历的时间为60秒<br>5）    吞吐量的测试结果为94.13Mbits/秒</p>
<blockquote>
<p>Reference <a target="_blank" rel="noopener" href="https://www.ibm.com/developerworks/cn/linux/l-netperf/">netperf 与网络性能测量</a></p>
</blockquote>
<h1 id="useful-commands"><a href="#useful-commands" class="headerlink" title="useful commands"></a>useful commands</h1><h1 id="Create-a-configuration-file-and-add-your-license-key"><a href="#Create-a-configuration-file-and-add-your-license-key" class="headerlink" title="Create a configuration file and add your license key \"></a>Create a configuration file and add your license key \</h1><p>echo “license_key: a61ac49b8930c041d9d940b8227f5d716819NRAL” | sudo tee -a /etc/newrelic-infra.yml &amp;&amp; \</p>
<p>\</p>
<h1 id="Create-the-agent’s-yum-repository"><a href="#Create-the-agent’s-yum-repository" class="headerlink" title="Create the agent’s yum repository \"></a>Create the agent’s yum repository \</h1><p>sudo curl -o /etc/yum.repos.d/newrelic-infra.repo <a target="_blank" rel="noopener" href="https://download.newrelic.com/infrastructure_agent/linux/yum/el/7/x86_64/newrelic-infra.repo">https://download.newrelic.com/infrastructure_agent/linux/yum/el/7/x86_64/newrelic-infra.repo</a> &amp;&amp; \</p>
<p>\</p>
<h1 id="Update-your-yum-cache"><a href="#Update-your-yum-cache" class="headerlink" title="Update your yum cache \"></a>Update your yum cache \</h1><p>sudo yum -q makecache -y –disablerepo=’*’ –enablerepo=’newrelic-infra’ &amp;&amp; \</p>
<p>\</p>
<h1 id="Run-the-installation-script"><a href="#Run-the-installation-script" class="headerlink" title="Run the installation script \"></a>Run the installation script \</h1><p>sudo yum install newrelic-infra -y</p>
<blockquote>
<p>Written with <a target="_blank" rel="noopener" href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/system-admin/">system admin</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/12/zabbix/" title="zabbix" itemprop="url">zabbix</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-12T04:54:53.000Z" itemprop="datePublished"> Published 2016-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="zabbix"><a href="#zabbix" class="headerlink" title="zabbix"></a>zabbix</h2><table>
<thead>
<tr>
<th>IP address</th>
<th>Roles</th>
<th>notes</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.0.49(chatswood)</td>
<td>zabbix server</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
</tr>
<tr>
<td>192.168.0.80(macadamina)</td>
<td>zabbix agent</td>
<td>Centos 6.8 Zabbix 2.4.8</td>
</tr>
</tbody></table>
<h2 id="server-setup"><a href="#server-setup" class="headerlink" title="server setup"></a>server setup</h2> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-server -y</span><br><span class="line">tar xf zabbix-2.4.8.tar.gz</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">./configure --prefix=/opt/zabbix --enable-server --enable-agent --with-mysql</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">yum install httpd php-devel php php-mbstring -y</span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line"><span class="built_in">cd</span> /opt/zabbix/</span><br><span class="line">mv etc&#123;,_bak&#125;</span><br><span class="line">/bin/cp -rf etc_bak/ etc</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_server.conf|egrep -v &quot;^#|^$&quot;</span></span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBSocket=/tmp/mysql.sock</span><br><span class="line">DBHost=chatswood</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br><span class="line">Timeout=30</span><br><span class="line">[root@chatswood ~]<span class="comment"># cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v &quot;^#|^$&quot;</span></span><br><span class="line">PidFile=/tmp/zabbix_agentd.pid</span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=chatswood</span><br><span class="line">Timeout=30</span><br><span class="line"></span><br><span class="line">/etc/init.d/mysqld start</span><br><span class="line"><span class="comment"># mysql</span></span><br><span class="line">mysql&gt; create database zabbix character <span class="built_in">set</span> utf8;</span><br><span class="line">mysql&gt; grant all on zabbix.* to zabbix@<span class="string">&#x27;192.168.0.49&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8/database/mysql</span><br><span class="line">mysql zabbix &lt; ./schema.sql -p</span><br><span class="line">mysql zabbix &lt; ./images.sql -p</span><br><span class="line">mysql zabbix &lt; ./data.sql -p</span><br><span class="line"><span class="comment">## test database</span></span><br><span class="line">mysql -u zabbix -p -h192.168.0.49</span><br><span class="line">mysql&gt; use zabbix;</span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">mysql&gt; <span class="built_in">exit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a zabbix user</span></span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_server -c /opt/zabbix/etc/zabbix_server.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># test</span></span><br><span class="line">/opt/zabbix/bin/zabbix_get -s chatswood -k proc.num[]</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> zabbix-2.4.8</span><br><span class="line">mkdir /var/www/html/zabbix</span><br><span class="line">/bin/cp -rf frontends/php/* /var/www/html/zabbix/</span><br><span class="line">vim /etc/php.ini</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">post_max_size = 18M</span><br><span class="line">max_execution_time = 350</span><br><span class="line">max_input_time = 350</span><br><span class="line"></span><br><span class="line">yum install php-gd php-xml php-mysql php-bcmath -y</span><br><span class="line">/etc/init.d/httpd restart</span><br><span class="line">ps aux|grep apache</span><br><span class="line">/usr/sbin/ntpdate 3.cn.pool.ntp.org</span><br><span class="line">chown -R apache /var/www/html/zabbix/</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="agent-setup"><a href="#agent-setup" class="headerlink" title="agent setup"></a>agent setup</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">192.168.0.80    macadamina</span><br><span class="line">192.168.0.49    chatswood</span><br><span class="line">./configure --prefix=/opt/zabbix --enable-agent --with-net-snmp</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">groupadd -g 508 zabbix</span><br><span class="line">useradd -g 508 -u 508 zabbix -M -s /sbin/nologin</span><br><span class="line">cat /opt/zabbix/etc/zabbix_agentd.conf|egrep -v <span class="string">&quot;^#|^$&quot;</span></span><br><span class="line">LogFile=/tmp/zabbix_agentd.log</span><br><span class="line">Server=chatswood</span><br><span class="line">ServerActive=chatswood</span><br><span class="line">Hostname=macadamina</span><br><span class="line"></span><br><span class="line">/opt/zabbix/sbin/zabbix_agentd -c /opt/zabbix/etc/zabbix_agentd.conf</span><br><span class="line">ps aux|grep zabbix</span><br><span class="line">lsof|grep zabbix</span><br></pre></td></tr></table></figure>
<p>Access <a target="_blank" rel="noopener" href="http://192.168.0.49/zabbix">http://192.168.0.49/zabbix</a>,<br>default username: admin<br>password: zabbix</p>
<hr>
<h2 id="issue"><a href="#issue" class="headerlink" title="issue"></a>issue</h2><hr>
<p>checking for mysql_config… /usr/bin/mysql_config<br>checking for main in -lmysqlclient… no<br>configure: error: Not found mysqlclient library</p>
<p>#yum -y install mysql-devel</p>
<blockquote>
<p>Written with <a target="_blank" rel="noopener" href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/centos/">centos</a><a href="/tags/zabbix/">zabbix</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/10/10/web-security/" title="web security" itemprop="url">web security</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="John Doe" target="_blank" itemprop="author">John Doe</a>
		
  <p class="article-time">
    <time datetime="2016-10-10T00:03:50.000Z" itemprop="datePublished"> Published 2016-10-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="web安全"><a href="#web安全" class="headerlink" title="web安全"></a>web安全</h1><h3 id="Table-of-contents"><a href="#Table-of-contents" class="headerlink" title="Table of contents"></a>Table of contents</h3><p>You can insert a table of contents using the marker <code>[TOC]</code>:</p>
<p>[TOC]</p>
<h2 id="使用iptables防护网站安全"><a href="#使用iptables防护网站安全" class="headerlink" title="使用iptables防护网站安全"></a>使用iptables防护网站安全</h2><blockquote>
<p><strong>只允许特定流量通过，禁用其他流量</strong></p>
</blockquote>
<blockquote>
<ul>
<li>permit ssh</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>permit DNS</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --sport 53 -j ACCEPT</span><br><span class="line">iptables -l INPUT 1 -p udp --sport 53 -j ACCEPT</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>permit service</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -l INPUT 1 -p tcp --dport 80 -j ACCEPT</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>forbid all others</li>
</ul>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -j DROP</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@toad ~]<span class="comment"># netstat -tn</span></span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State</span><br><span class="line">tcp        0      0 192.168.199.231:61094       101.200.31.147:443          TIME_WAIT</span><br><span class="line">tcp        0     64 192.168.199.231:22          60.186.174.98:61241         ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:41795       192.168.199.1:445           ESTABLISHED</span><br><span class="line">tcp        0      0 192.168.199.231:22          60.186.174.98:50722         ESTABLISHED</span><br><span class="line">tcp        0      0 ::1:19187                   ::1:10010                   TIME_WAIT</span><br><span class="line"></span><br><span class="line">[root@toad ~]<span class="comment"># netstat -tn|grep 192.168.199.231|awk &#x27;&#123;print $5&#125;&#x27;|awk -F &quot;:&quot; &#x27;&#123;print $1&#125;&#x27;|sort|uniq -c|sort -r -n</span></span><br><span class="line">      2 60.186.174.98</span><br><span class="line">      2 101.200.31.147</span><br><span class="line">      1 192.168.199.1</span><br><span class="line">[root@toad ~]<span class="comment"># iptables -l INPUT 1 -s 60.186.174.98 -j DROP</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="AIDE入侵检测系统"><a href="#AIDE入侵检测系统" class="headerlink" title="AIDE入侵检测系统"></a>AIDE入侵检测系统</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#install aide</span></span><br><span class="line">yum install -y aide</span><br><span class="line"></span><br><span class="line"><span class="comment">#config aide</span></span><br><span class="line">vim /etc/aide.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#init aide database</span></span><br><span class="line">aide --init</span><br><span class="line">mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz</span><br><span class="line"></span><br><span class="line"><span class="comment">#check monitor file</span></span><br><span class="line">aide --check</span><br><span class="line"></span><br><span class="line"><span class="comment">#update aide database</span></span><br><span class="line">aide --update</span><br><span class="line"></span><br><span class="line"><span class="comment">#setup cron job</span></span><br><span class="line">crontab -e</span><br><span class="line">* 3 * * * /usr/sbin/aide --check|mail -s <span class="string">&quot;AIDE report &quot;</span> sizemore@gmail.com</span><br></pre></td></tr></table></figure>



        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/web-security/">web security</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/">&lt;span&gt;&lt;&#x2F;span&gt;Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/">Next&lt;span&gt;&lt;&#x2F;span&gt;</a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="stanosaka" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  

  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/devops/" title="devops">devops<sup>16</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/aws/" title="aws">aws<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/CICD/" title="CICD">CICD<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/centos/" title="centos">centos<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Jenkins/" title="Jenkins">Jenkins<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/mysql/" title="mysql">mysql<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/SRE/" title="SRE">SRE<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/azure/" title="azure">azure<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/tomcat/" title="tomcat">tomcat<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/saltstack/" title="saltstack">saltstack<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/zabbix/" title="zabbix">zabbix<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/IaC/" title="IaC">IaC<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ec2/" title="ec2">ec2<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/backup/" title="backup">backup<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/puppet/" title="puppet">puppet<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="https://github.com/kahun/awesome-sysadmin" target="_blank" title="Awesome-sysadmin">Awesome-sysadmin</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/crazy-canux/awesome-monitoring" target="_blank" title="Awesome-monitoring">Awesome-monitoring</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.opsschool.org/index.html" target="_blank" title="Ops School Curriculum">Ops School Curriculum</a>
            
          </li>
        
          <li>
            
            	<a href="https://kupczynski.info/2018/04/18/spacemacs.html" target="_blank" title="Learning Spacemacs">Learning Spacemacs</a>
            
          </li>
        
          <li>
            
            	<a href="https://landing.google.com/sre/books/" target="_blank" title="SRE Books">SRE Books</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/aws-samples" target="_blank" title="AWS Samples">AWS Samples</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/bikrambora/devlab-launchpad" target="_blank" title="Welcome to Dev Labs">Dev Labs</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/ansible/ansible-examples" target="_blank" title="Ansible GitHub repo">Ansible GitHub repo</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html" target="_blank" title="Ansible Best Practices">Ansible Best Practices</a>
            
          </li>
        
          <li>
            
            	<a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" title="kubectl cheat sheet">kubectl cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://rogerdudler.github.io/git-guide" target="_blank" title="Git commands">Git commands</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.docker.com/engine/reference/builder/" target="_blank" title="Dockerfile reference">Dockerfile reference</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2mTQr8l" target="_blank" title="Linux Command line cheat sheet">Linux Command line cheat sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://bit.ly/2EPHxze" target="_blank" title="PowerShell Basic Cheat Sheet">PowerShell Basic Cheat Sheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://sed.sourceforge.net/sed1line_zh-CN.html" target="_blank" title="sed cheatsheet">sed cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="http://obsavus1p.bkt.clouddn.com/vim_cheat_sheet_for_programmers_print.png" target="_blank" title="vim cheatsheet">vim cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.gitbook.com/book/yeasy/docker_practice/details" target="_blank" title="Learn Docker">Learn Docker</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.unixhot.com/page/ops" target="_blank" title="运维知识体系">运维知识体系</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.tecmint.com/" target="_blank" title="tecmint">tecmint</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.lib.uts.edu.au" target="_blank" title="shoujin.wang@student.uts.edu.au">UTS Library</a>
            
          </li>
        
          <li>
            
            	<a href="https://7esl.com" target="_blank" title="ESL">ESL</a>
            
          </li>
        
          <li>
            
            	<a href="https://stanchou.wordpress.com" target="_blank" title="Stan&#39;s wordpress">Stan&#39;s wordpress</a>
            
          </li>
        
          <li>
            
            	<a href="https://docs.00root.com" target="_blank" title="Stan&#39;s gitbook">Stan&#39;s gitbook</a>
            
          </li>
        
          <li>
            
            	<a href="https://api.ipify.org" target="_blank" title="Your IP address">Your IP address</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/stanosaka/oreilly_sql_fundamentals_for_data/blob/master/notes_and_slides/sql_fundamentals_notes.md" target="_blank" title="sql fundamentials">sql fundamentials</a>
            
          </li>
        
          <li>
            
            	<a href="https://www.nerdfonts.com" target="_blank" title="Nred Fonts">Nred Fonts</a>
            
          </li>
        
          <li>
            
            	<a href="http://cb.vu/unixtoolbox.xhtml" target="_blank" title="UNIX TOOLBOX">UNIX TOOLBOX</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/Ben-PH/spacemacs-cheatsheet" target="_blank" title="spacemacs-cheatsheet">spacemacs-cheatsheet</a>
            
          </li>
        
          <li>
            
            	<a href="https://rubular.com/" target="_blank" title="Regular expression editor 1">Regular expression editor 1</a>
            
          </li>
        
          <li>
            
            	<a href="https://pythex.org/" target="_blank" title="Regular expression editor 2">Regular expression editor 2</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Stan. <br/>
			I am a Site Reliability Engineer working and living in Sydney.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/stanosaka" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/6724938" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/stanosaka" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/stan.osaka" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/00root" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/btw01v" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/stan-22-82" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
		<a href="mailto:devops@cwzhou.win" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2021 
		
		<a href="/about" target="_blank" title="John Doe">John Doe</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>












<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
